\doxysection{Vit\+NX\+\_\+\+Tree\+View.\+cs}
\label{a00158_source}\index{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Controls/VitNX\_TreeView.cs@{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Controls/VitNX\_TreeView.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.Collections.ObjectModel;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} System.Collections.Specialized;}
\DoxyCodeLine{00005 \textcolor{keyword}{using} System.ComponentModel;}
\DoxyCodeLine{00006 \textcolor{keyword}{using} System.Drawing;}
\DoxyCodeLine{00007 \textcolor{keyword}{using} System.Linq;}
\DoxyCodeLine{00008 \textcolor{keyword}{using} System.Windows.Forms;}
\DoxyCodeLine{00009 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Collections;}
\DoxyCodeLine{00010 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Config;}
\DoxyCodeLine{00011 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Extensions;}
\DoxyCodeLine{00012 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Forms;}
\DoxyCodeLine{00013 }
\DoxyCodeLine{00014 \textcolor{keyword}{namespace }VitNX.UI.BasedOnDarkUI.Controls}
\DoxyCodeLine{00015 \{}
\DoxyCodeLine{00016     \textcolor{keyword}{public} \textcolor{keyword}{class }VitNX\_TreeView : VitNX\_ScrollView}
\DoxyCodeLine{00017     \{}
\DoxyCodeLine{00018 \textcolor{preprocessor}{        \#region Event Region}}
\DoxyCodeLine{00019 }
\DoxyCodeLine{00020         \textcolor{keyword}{public} \textcolor{keyword}{event} EventHandler SelectedNodesChanged;}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022         \textcolor{keyword}{public} \textcolor{keyword}{event} EventHandler AfterNodeExpand;}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024         \textcolor{keyword}{public} \textcolor{keyword}{event} EventHandler AfterNodeCollapse;}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026 \textcolor{preprocessor}{        \#endregion Event Region}}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028 \textcolor{preprocessor}{        \#region Field Region}}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} \_disposed;}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032         \textcolor{keyword}{private} readonly \textcolor{keywordtype}{int} \_expandAreaSize = 16;}
\DoxyCodeLine{00033         \textcolor{keyword}{private} readonly \textcolor{keywordtype}{int} \_iconSize = 16;}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_itemHeight = 20;}
\DoxyCodeLine{00036         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_indent = 20;}
\DoxyCodeLine{00037 }
\DoxyCodeLine{00038         \textcolor{keyword}{private} ObservableList<VitNX\_TreeNode> \_nodes;}
\DoxyCodeLine{00039         \textcolor{keyword}{private} ObservableCollection<VitNX\_TreeNode> \_selectedNodes;}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041         \textcolor{keyword}{private} VitNX\_TreeNode \_anchoredNodeStart;}
\DoxyCodeLine{00042         \textcolor{keyword}{private} VitNX\_TreeNode \_anchoredNodeEnd;}
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044         \textcolor{keyword}{private} Bitmap \_nodeClosed;}
\DoxyCodeLine{00045         \textcolor{keyword}{private} Bitmap \_nodeClosedHover;}
\DoxyCodeLine{00046         \textcolor{keyword}{private} Bitmap \_nodeClosedHoverSelected;}
\DoxyCodeLine{00047         \textcolor{keyword}{private} Bitmap \_nodeOpen;}
\DoxyCodeLine{00048         \textcolor{keyword}{private} Bitmap \_nodeOpenHover;}
\DoxyCodeLine{00049         \textcolor{keyword}{private} Bitmap \_nodeOpenHoverSelected;}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051         \textcolor{keyword}{private} VitNX\_TreeNode \_provisionalNode;}
\DoxyCodeLine{00052         \textcolor{keyword}{private} VitNX\_TreeNode \_dropNode;}
\DoxyCodeLine{00053         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} \_provisionalDragging;}
\DoxyCodeLine{00054         \textcolor{keyword}{private} List<VitNX\_TreeNode> \_dragNodes;}
\DoxyCodeLine{00055         \textcolor{keyword}{private} Point \_dragPos;}
\DoxyCodeLine{00056 }
\DoxyCodeLine{00057 \textcolor{preprocessor}{        \#endregion Field Region}}
\DoxyCodeLine{00058 }
\DoxyCodeLine{00059 \textcolor{preprocessor}{        \#region Property Region}}
\DoxyCodeLine{00060 }
\DoxyCodeLine{00061         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00062         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00063         \textcolor{keyword}{public} ObservableList<VitNX\_TreeNode> Nodes}
\DoxyCodeLine{00064         \{}
\DoxyCodeLine{00065             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_nodes; \}}
\DoxyCodeLine{00066             \textcolor{keyword}{set}}
\DoxyCodeLine{00067             \{}
\DoxyCodeLine{00068                 \textcolor{keywordflow}{if} (\_nodes != \textcolor{keyword}{null})}
\DoxyCodeLine{00069                 \{}
\DoxyCodeLine{00070                     \_nodes.ItemsAdded -\/= Nodes\_ItemsAdded;}
\DoxyCodeLine{00071                     \_nodes.ItemsRemoved -\/= Nodes\_ItemsRemoved;}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073                     \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} \_nodes)}
\DoxyCodeLine{00074                         UnhookNodeEvents(node);}
\DoxyCodeLine{00075                 \}}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077                 \_nodes = value;}
\DoxyCodeLine{00078 }
\DoxyCodeLine{00079                 \_nodes.ItemsAdded += Nodes\_ItemsAdded;}
\DoxyCodeLine{00080                 \_nodes.ItemsRemoved += Nodes\_ItemsRemoved;}
\DoxyCodeLine{00081 }
\DoxyCodeLine{00082                 \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} \_nodes)}
\DoxyCodeLine{00083                     HookNodeEvents(node);}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085                 UpdateNodes();}
\DoxyCodeLine{00086             \}}
\DoxyCodeLine{00087         \}}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00090         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00091         \textcolor{keyword}{public} ObservableCollection<VitNX\_TreeNode> SelectedNodes}
\DoxyCodeLine{00092         \{}
\DoxyCodeLine{00093             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_selectedNodes; \}}
\DoxyCodeLine{00094         \}}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096         [Category(\textcolor{stringliteral}{"{}Appearance"{}})]}
\DoxyCodeLine{00097         [Description(\textcolor{stringliteral}{"{}Determines the height of tree nodes."{}})]}
\DoxyCodeLine{00098         [DefaultValue(20)]}
\DoxyCodeLine{00099         \textcolor{keyword}{public} \textcolor{keywordtype}{int} ItemHeight}
\DoxyCodeLine{00100         \{}
\DoxyCodeLine{00101             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_itemHeight; \}}
\DoxyCodeLine{00102             \textcolor{keyword}{set}}
\DoxyCodeLine{00103             \{}
\DoxyCodeLine{00104                 \_itemHeight = value;}
\DoxyCodeLine{00105                 MaxDragChange = \_itemHeight;}
\DoxyCodeLine{00106                 UpdateNodes();}
\DoxyCodeLine{00107             \}}
\DoxyCodeLine{00108         \}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110         [Category(\textcolor{stringliteral}{"{}Appearance"{}})]}
\DoxyCodeLine{00111         [Description(\textcolor{stringliteral}{"{}Determines the amount of horizontal space given by parent node."{}})]}
\DoxyCodeLine{00112         [DefaultValue(20)]}
\DoxyCodeLine{00113         \textcolor{keyword}{public} \textcolor{keywordtype}{int} Indent}
\DoxyCodeLine{00114         \{}
\DoxyCodeLine{00115             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_indent; \}}
\DoxyCodeLine{00116             \textcolor{keyword}{set}}
\DoxyCodeLine{00117             \{}
\DoxyCodeLine{00118                 \_indent = value;}
\DoxyCodeLine{00119                 UpdateNodes();}
\DoxyCodeLine{00120             \}}
\DoxyCodeLine{00121         \}}
\DoxyCodeLine{00122 }
\DoxyCodeLine{00123         [Category(\textcolor{stringliteral}{"{}Behavior"{}})]}
\DoxyCodeLine{00124         [Description(\textcolor{stringliteral}{"{}Determines whether multiple tree nodes can be selected at once."{}})]}
\DoxyCodeLine{00125         [DefaultValue(\textcolor{keyword}{false})]}
\DoxyCodeLine{00126         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} MultiSelect \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128         [Category(\textcolor{stringliteral}{"{}Behavior"{}})]}
\DoxyCodeLine{00129         [Description(\textcolor{stringliteral}{"{}Determines whether nodes can be moved within this tree view."{}})]}
\DoxyCodeLine{00130         [DefaultValue(\textcolor{keyword}{false})]}
\DoxyCodeLine{00131         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} AllowMoveNodes \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133         [Category(\textcolor{stringliteral}{"{}Appearance"{}})]}
\DoxyCodeLine{00134         [Description(\textcolor{stringliteral}{"{}Determines whether icons are rendered with the tree nodes."{}})]}
\DoxyCodeLine{00135         [DefaultValue(\textcolor{keyword}{false})]}
\DoxyCodeLine{00136         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ShowIcons \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00137 }
\DoxyCodeLine{00138         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00139         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00140         \textcolor{keyword}{public} \textcolor{keywordtype}{int} VisibleNodeCount \{ \textcolor{keyword}{get}; \textcolor{keyword}{private} \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00143         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00144         \textcolor{keyword}{public} IComparer<VitNX\_TreeNode> TreeViewNodeSorter \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00145 }
\DoxyCodeLine{00146 \textcolor{preprocessor}{        \#endregion Property Region}}
\DoxyCodeLine{00147 }
\DoxyCodeLine{00148 \textcolor{preprocessor}{        \#region Constructor Region}}
\DoxyCodeLine{00149 }
\DoxyCodeLine{00150         \textcolor{keyword}{public} VitNX\_TreeView()}
\DoxyCodeLine{00151         \{}
\DoxyCodeLine{00152             Nodes = \textcolor{keyword}{new} ObservableList<VitNX\_TreeNode>();}
\DoxyCodeLine{00153             \_selectedNodes = \textcolor{keyword}{new} ObservableCollection<VitNX\_TreeNode>();}
\DoxyCodeLine{00154             \_selectedNodes.CollectionChanged += SelectedNodes\_CollectionChanged;}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156             MaxDragChange = \_itemHeight;}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158             LoadIcons();}
\DoxyCodeLine{00159         \}}
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161 \textcolor{preprocessor}{        \#endregion Constructor Region}}
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163 \textcolor{preprocessor}{        \#region Dispose Region}}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} Dispose(\textcolor{keywordtype}{bool} disposing)}
\DoxyCodeLine{00166         \{}
\DoxyCodeLine{00167             \textcolor{keywordflow}{if} (!\_disposed)}
\DoxyCodeLine{00168             \{}
\DoxyCodeLine{00169                 DisposeIcons();}
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171                 \textcolor{keywordflow}{if} (SelectedNodesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00172                     SelectedNodesChanged = \textcolor{keyword}{null};}
\DoxyCodeLine{00173 }
\DoxyCodeLine{00174                 \textcolor{keywordflow}{if} (AfterNodeExpand != \textcolor{keyword}{null})}
\DoxyCodeLine{00175                     AfterNodeExpand = \textcolor{keyword}{null};}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177                 \textcolor{keywordflow}{if} (AfterNodeCollapse != \textcolor{keyword}{null})}
\DoxyCodeLine{00178                     AfterNodeExpand = \textcolor{keyword}{null};}
\DoxyCodeLine{00179 }
\DoxyCodeLine{00180                 \textcolor{keywordflow}{if} (\_nodes != \textcolor{keyword}{null})}
\DoxyCodeLine{00181                     \_nodes.Dispose();}
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183                 \textcolor{keywordflow}{if} (\_selectedNodes != \textcolor{keyword}{null})}
\DoxyCodeLine{00184                     \_selectedNodes.CollectionChanged -\/= SelectedNodes\_CollectionChanged;}
\DoxyCodeLine{00185 }
\DoxyCodeLine{00186                 \_disposed = \textcolor{keyword}{true};}
\DoxyCodeLine{00187             \}}
\DoxyCodeLine{00188 }
\DoxyCodeLine{00189             base.Dispose(disposing);}
\DoxyCodeLine{00190         \}}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192 \textcolor{preprocessor}{        \#endregion Dispose Region}}
\DoxyCodeLine{00193 }
\DoxyCodeLine{00194 \textcolor{preprocessor}{        \#region Event Handler Region}}
\DoxyCodeLine{00195 }
\DoxyCodeLine{00196         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Nodes\_ItemsAdded(\textcolor{keywordtype}{object} sender, ObservableListModified<VitNX\_TreeNode> e)}
\DoxyCodeLine{00197         \{}
\DoxyCodeLine{00198             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} e.Items)}
\DoxyCodeLine{00199             \{}
\DoxyCodeLine{00200                 node.ParentTree = \textcolor{keyword}{this};}
\DoxyCodeLine{00201                 node.IsRoot = \textcolor{keyword}{true};}
\DoxyCodeLine{00202 }
\DoxyCodeLine{00203                 HookNodeEvents(node);}
\DoxyCodeLine{00204             \}}
\DoxyCodeLine{00205 }
\DoxyCodeLine{00206             \textcolor{keywordflow}{if} (TreeViewNodeSorter != \textcolor{keyword}{null})}
\DoxyCodeLine{00207                 Nodes.Sort(TreeViewNodeSorter);}
\DoxyCodeLine{00208 }
\DoxyCodeLine{00209             UpdateNodes();}
\DoxyCodeLine{00210         \}}
\DoxyCodeLine{00211 }
\DoxyCodeLine{00212         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Nodes\_ItemsRemoved(\textcolor{keywordtype}{object} sender, ObservableListModified<VitNX\_TreeNode> e)}
\DoxyCodeLine{00213         \{}
\DoxyCodeLine{00214             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} e.Items)}
\DoxyCodeLine{00215             \{}
\DoxyCodeLine{00216                 node.ParentTree = \textcolor{keyword}{this};}
\DoxyCodeLine{00217                 node.IsRoot = \textcolor{keyword}{true};}
\DoxyCodeLine{00218 }
\DoxyCodeLine{00219                 HookNodeEvents(node);}
\DoxyCodeLine{00220             \}}
\DoxyCodeLine{00221 }
\DoxyCodeLine{00222             UpdateNodes();}
\DoxyCodeLine{00223         \}}
\DoxyCodeLine{00224 }
\DoxyCodeLine{00225         \textcolor{keyword}{private} \textcolor{keywordtype}{void} ChildNodes\_ItemsAdded(\textcolor{keywordtype}{object} sender, ObservableListModified<VitNX\_TreeNode> e)}
\DoxyCodeLine{00226         \{}
\DoxyCodeLine{00227             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} e.Items)}
\DoxyCodeLine{00228                 HookNodeEvents(node);}
\DoxyCodeLine{00229 }
\DoxyCodeLine{00230             UpdateNodes();}
\DoxyCodeLine{00231         \}}
\DoxyCodeLine{00232 }
\DoxyCodeLine{00233         \textcolor{keyword}{private} \textcolor{keywordtype}{void} ChildNodes\_ItemsRemoved(\textcolor{keywordtype}{object} sender, ObservableListModified<VitNX\_TreeNode> e)}
\DoxyCodeLine{00234         \{}
\DoxyCodeLine{00235             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} e.Items)}
\DoxyCodeLine{00236             \{}
\DoxyCodeLine{00237                 \textcolor{keywordflow}{if} (SelectedNodes.Contains(node))}
\DoxyCodeLine{00238                     SelectedNodes.Remove(node);}
\DoxyCodeLine{00239 }
\DoxyCodeLine{00240                 UnhookNodeEvents(node);}
\DoxyCodeLine{00241             \}}
\DoxyCodeLine{00242 }
\DoxyCodeLine{00243             UpdateNodes();}
\DoxyCodeLine{00244         \}}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246         \textcolor{keyword}{private} \textcolor{keywordtype}{void} SelectedNodes\_CollectionChanged(\textcolor{keywordtype}{object} sender, NotifyCollectionChangedEventArgs e)}
\DoxyCodeLine{00247         \{}
\DoxyCodeLine{00248             \textcolor{keywordflow}{if} (SelectedNodesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00249                 SelectedNodesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00250         \}}
\DoxyCodeLine{00251 }
\DoxyCodeLine{00252         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Nodes\_TextChanged(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00253         \{}
\DoxyCodeLine{00254             UpdateNodes();}
\DoxyCodeLine{00255         \}}
\DoxyCodeLine{00256 }
\DoxyCodeLine{00257         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Nodes\_NodeExpanded(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00258         \{}
\DoxyCodeLine{00259             UpdateNodes();}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261             \textcolor{keywordflow}{if} (AfterNodeExpand != \textcolor{keyword}{null})}
\DoxyCodeLine{00262                 AfterNodeExpand(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00263         \}}
\DoxyCodeLine{00264 }
\DoxyCodeLine{00265         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Nodes\_NodeCollapsed(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00266         \{}
\DoxyCodeLine{00267             UpdateNodes();}
\DoxyCodeLine{00268 }
\DoxyCodeLine{00269             \textcolor{keywordflow}{if} (AfterNodeCollapse != \textcolor{keyword}{null})}
\DoxyCodeLine{00270                 AfterNodeCollapse(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00271         \}}
\DoxyCodeLine{00272 }
\DoxyCodeLine{00273         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseMove(MouseEventArgs e)}
\DoxyCodeLine{00274         \{}
\DoxyCodeLine{00275             \textcolor{keywordflow}{if} (\_provisionalDragging)}
\DoxyCodeLine{00276             \{}
\DoxyCodeLine{00277                 \textcolor{keywordflow}{if} (OffsetMousePosition != \_dragPos)}
\DoxyCodeLine{00278                 \{}
\DoxyCodeLine{00279                     StartDrag();}
\DoxyCodeLine{00280                     HandleDrag();}
\DoxyCodeLine{00281                     \textcolor{keywordflow}{return};}
\DoxyCodeLine{00282                 \}}
\DoxyCodeLine{00283             \}}
\DoxyCodeLine{00284 }
\DoxyCodeLine{00285             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00286             \{}
\DoxyCodeLine{00287                 \textcolor{keywordflow}{if} (\_dropNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00288                 \{}
\DoxyCodeLine{00289                     var rect = GetNodeFullRowArea(\_dropNode);}
\DoxyCodeLine{00290                     \textcolor{keywordflow}{if} (!rect.Contains(OffsetMousePosition))}
\DoxyCodeLine{00291                     \{}
\DoxyCodeLine{00292                         \_dropNode = \textcolor{keyword}{null};}
\DoxyCodeLine{00293                         Invalidate();}
\DoxyCodeLine{00294                     \}}
\DoxyCodeLine{00295                 \}}
\DoxyCodeLine{00296             \}}
\DoxyCodeLine{00297 }
\DoxyCodeLine{00298             CheckHover();}
\DoxyCodeLine{00299 }
\DoxyCodeLine{00300             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00301             \{}
\DoxyCodeLine{00302                 HandleDrag();}
\DoxyCodeLine{00303             \}}
\DoxyCodeLine{00304 }
\DoxyCodeLine{00305             base.OnMouseMove(e);}
\DoxyCodeLine{00306         \}}
\DoxyCodeLine{00307 }
\DoxyCodeLine{00308         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseWheel(MouseEventArgs e)}
\DoxyCodeLine{00309         \{}
\DoxyCodeLine{00310             CheckHover();}
\DoxyCodeLine{00311 }
\DoxyCodeLine{00312             base.OnMouseWheel(e);}
\DoxyCodeLine{00313         \}}
\DoxyCodeLine{00314 }
\DoxyCodeLine{00315         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseDown(MouseEventArgs e)}
\DoxyCodeLine{00316         \{}
\DoxyCodeLine{00317             \textcolor{keywordflow}{if} (e.Button == MouseButtons.Left || e.Button == MouseButtons.Right)}
\DoxyCodeLine{00318             \{}
\DoxyCodeLine{00319                 \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00320                     CheckNodeClick(node, OffsetMousePosition, e.Button);}
\DoxyCodeLine{00321             \}}
\DoxyCodeLine{00322 }
\DoxyCodeLine{00323             base.OnMouseDown(e);}
\DoxyCodeLine{00324         \}}
\DoxyCodeLine{00325 }
\DoxyCodeLine{00326         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseUp(MouseEventArgs e)}
\DoxyCodeLine{00327         \{}
\DoxyCodeLine{00328             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00329             \{}
\DoxyCodeLine{00330                 HandleDrop();}
\DoxyCodeLine{00331             \}}
\DoxyCodeLine{00332 }
\DoxyCodeLine{00333             \textcolor{keywordflow}{if} (\_provisionalDragging)}
\DoxyCodeLine{00334             \{}
\DoxyCodeLine{00335                 \textcolor{keywordflow}{if} (\_provisionalNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00336                 \{}
\DoxyCodeLine{00337                     var pos = \_dragPos;}
\DoxyCodeLine{00338                     \textcolor{keywordflow}{if} (OffsetMousePosition == pos)}
\DoxyCodeLine{00339                         SelectNode(\_provisionalNode);}
\DoxyCodeLine{00340                 \}}
\DoxyCodeLine{00341 }
\DoxyCodeLine{00342                 \_provisionalDragging = \textcolor{keyword}{false};}
\DoxyCodeLine{00343             \}}
\DoxyCodeLine{00344 }
\DoxyCodeLine{00345             base.OnMouseUp(e);}
\DoxyCodeLine{00346         \}}
\DoxyCodeLine{00347 }
\DoxyCodeLine{00348         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseDoubleClick(MouseEventArgs e)}
\DoxyCodeLine{00349         \{}
\DoxyCodeLine{00350             \textcolor{keywordflow}{if} (ModifierKeys == Keys.Control)}
\DoxyCodeLine{00351                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00352 }
\DoxyCodeLine{00353             \textcolor{keywordflow}{if} (e.Button == MouseButtons.Left)}
\DoxyCodeLine{00354             \{}
\DoxyCodeLine{00355                 \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00356                     CheckNodeDoubleClick(node, OffsetMousePosition);}
\DoxyCodeLine{00357             \}}
\DoxyCodeLine{00358 }
\DoxyCodeLine{00359             base.OnMouseDoubleClick(e);}
\DoxyCodeLine{00360         \}}
\DoxyCodeLine{00361 }
\DoxyCodeLine{00362         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseLeave(EventArgs e)}
\DoxyCodeLine{00363         \{}
\DoxyCodeLine{00364             base.OnMouseLeave(e);}
\DoxyCodeLine{00365 }
\DoxyCodeLine{00366             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00367                 NodeMouseLeave(node);}
\DoxyCodeLine{00368         \}}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnKeyDown(KeyEventArgs e)}
\DoxyCodeLine{00371         \{}
\DoxyCodeLine{00372             base.OnKeyDown(e);}
\DoxyCodeLine{00373 }
\DoxyCodeLine{00374             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00375                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00376 }
\DoxyCodeLine{00377             \textcolor{keywordflow}{if} (Nodes.Count == 0)}
\DoxyCodeLine{00378                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00379 }
\DoxyCodeLine{00380             \textcolor{keywordflow}{if} (e.KeyCode != Keys.Down \&\& e.KeyCode != Keys.Up \&\& e.KeyCode != Keys.Left \&\& e.KeyCode != Keys.Right)}
\DoxyCodeLine{00381                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00382 }
\DoxyCodeLine{00383             \textcolor{keywordflow}{if} (\_anchoredNodeEnd == \textcolor{keyword}{null})}
\DoxyCodeLine{00384             \{}
\DoxyCodeLine{00385                 \textcolor{keywordflow}{if} (Nodes.Count > 0)}
\DoxyCodeLine{00386                     SelectNode(Nodes[0]);}
\DoxyCodeLine{00387                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00388             \}}
\DoxyCodeLine{00389 }
\DoxyCodeLine{00390             \textcolor{keywordflow}{if} (e.KeyCode == Keys.Down || e.KeyCode == Keys.Up)}
\DoxyCodeLine{00391             \{}
\DoxyCodeLine{00392                 \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Shift)}
\DoxyCodeLine{00393                 \{}
\DoxyCodeLine{00394                     \textcolor{keywordflow}{if} (e.KeyCode == Keys.Up)}
\DoxyCodeLine{00395                     \{}
\DoxyCodeLine{00396                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.PrevVisibleNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00397                         \{}
\DoxyCodeLine{00398                             SelectAnchoredRange(\_anchoredNodeEnd.PrevVisibleNode);}
\DoxyCodeLine{00399                             EnsureVisible();}
\DoxyCodeLine{00400                         \}}
\DoxyCodeLine{00401                     \}}
\DoxyCodeLine{00402                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.KeyCode == Keys.Down)}
\DoxyCodeLine{00403                     \{}
\DoxyCodeLine{00404                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.NextVisibleNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00405                         \{}
\DoxyCodeLine{00406                             SelectAnchoredRange(\_anchoredNodeEnd.NextVisibleNode);}
\DoxyCodeLine{00407                             EnsureVisible();}
\DoxyCodeLine{00408                         \}}
\DoxyCodeLine{00409                     \}}
\DoxyCodeLine{00410                 \}}
\DoxyCodeLine{00411                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{00412                 \{}
\DoxyCodeLine{00413                     \textcolor{keywordflow}{if} (e.KeyCode == Keys.Up)}
\DoxyCodeLine{00414                     \{}
\DoxyCodeLine{00415                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.PrevVisibleNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00416                         \{}
\DoxyCodeLine{00417                             SelectNode(\_anchoredNodeEnd.PrevVisibleNode);}
\DoxyCodeLine{00418                             EnsureVisible();}
\DoxyCodeLine{00419                         \}}
\DoxyCodeLine{00420                     \}}
\DoxyCodeLine{00421                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.KeyCode == Keys.Down)}
\DoxyCodeLine{00422                     \{}
\DoxyCodeLine{00423                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.NextVisibleNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00424                         \{}
\DoxyCodeLine{00425                             SelectNode(\_anchoredNodeEnd.NextVisibleNode);}
\DoxyCodeLine{00426                             EnsureVisible();}
\DoxyCodeLine{00427                         \}}
\DoxyCodeLine{00428                     \}}
\DoxyCodeLine{00429                 \}}
\DoxyCodeLine{00430             \}}
\DoxyCodeLine{00431 }
\DoxyCodeLine{00432             \textcolor{keywordflow}{if} (e.KeyCode == Keys.Left || e.KeyCode == Keys.Right)}
\DoxyCodeLine{00433             \{}
\DoxyCodeLine{00434                 \textcolor{keywordflow}{if} (e.KeyCode == Keys.Left)}
\DoxyCodeLine{00435                 \{}
\DoxyCodeLine{00436                     \textcolor{keywordflow}{if} (\_anchoredNodeEnd.Expanded \&\& \_anchoredNodeEnd.Nodes.Count > 0)}
\DoxyCodeLine{00437                     \{}
\DoxyCodeLine{00438                         \_anchoredNodeEnd.Expanded = \textcolor{keyword}{false};}
\DoxyCodeLine{00439                     \}}
\DoxyCodeLine{00440                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00441                     \{}
\DoxyCodeLine{00442                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.ParentNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00443                         \{}
\DoxyCodeLine{00444                             SelectNode(\_anchoredNodeEnd.ParentNode);}
\DoxyCodeLine{00445                             EnsureVisible();}
\DoxyCodeLine{00446                         \}}
\DoxyCodeLine{00447                     \}}
\DoxyCodeLine{00448                 \}}
\DoxyCodeLine{00449                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.KeyCode == Keys.Right)}
\DoxyCodeLine{00450                 \{}
\DoxyCodeLine{00451                     \textcolor{keywordflow}{if} (!\_anchoredNodeEnd.Expanded)}
\DoxyCodeLine{00452                     \{}
\DoxyCodeLine{00453                         \_anchoredNodeEnd.Expanded = \textcolor{keyword}{true};}
\DoxyCodeLine{00454                     \}}
\DoxyCodeLine{00455                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00456                     \{}
\DoxyCodeLine{00457                         \textcolor{keywordflow}{if} (\_anchoredNodeEnd.Nodes.Count > 0)}
\DoxyCodeLine{00458                         \{}
\DoxyCodeLine{00459                             SelectNode(\_anchoredNodeEnd.Nodes[0]);}
\DoxyCodeLine{00460                             EnsureVisible();}
\DoxyCodeLine{00461                         \}}
\DoxyCodeLine{00462                     \}}
\DoxyCodeLine{00463                 \}}
\DoxyCodeLine{00464             \}}
\DoxyCodeLine{00465         \}}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DragTimer\_Tick(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00468         \{}
\DoxyCodeLine{00469             \textcolor{keywordflow}{if} (!IsDragging)}
\DoxyCodeLine{00470             \{}
\DoxyCodeLine{00471                 StopDrag();}
\DoxyCodeLine{00472                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00473             \}}
\DoxyCodeLine{00474 }
\DoxyCodeLine{00475             \textcolor{keywordflow}{if} (MouseButtons != MouseButtons.Left)}
\DoxyCodeLine{00476             \{}
\DoxyCodeLine{00477                 StopDrag();}
\DoxyCodeLine{00478                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00479             \}}
\DoxyCodeLine{00480 }
\DoxyCodeLine{00481             var pos = PointToClient(MousePosition);}
\DoxyCodeLine{00482 }
\DoxyCodeLine{00483             \textcolor{keywordflow}{if} (\_vScrollBar.Visible)}
\DoxyCodeLine{00484             \{}
\DoxyCodeLine{00485                 \textcolor{comment}{// Scroll up}}
\DoxyCodeLine{00486                 \textcolor{keywordflow}{if} (pos.Y < ClientRectangle.Top)}
\DoxyCodeLine{00487                 \{}
\DoxyCodeLine{00488                     var difference = (pos.Y -\/ ClientRectangle.Top) * -\/1;}
\DoxyCodeLine{00489 }
\DoxyCodeLine{00490                     \textcolor{keywordflow}{if} (difference > ItemHeight)}
\DoxyCodeLine{00491                         difference = ItemHeight;}
\DoxyCodeLine{00492 }
\DoxyCodeLine{00493                     \_vScrollBar.Value = \_vScrollBar.Value -\/ difference;}
\DoxyCodeLine{00494                 \}}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496                 \textcolor{comment}{// Scroll down}}
\DoxyCodeLine{00497                 \textcolor{keywordflow}{if} (pos.Y > ClientRectangle.Bottom)}
\DoxyCodeLine{00498                 \{}
\DoxyCodeLine{00499                     var difference = pos.Y -\/ ClientRectangle.Bottom;}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501                     \textcolor{keywordflow}{if} (difference > ItemHeight)}
\DoxyCodeLine{00502                         difference = ItemHeight;}
\DoxyCodeLine{00503 }
\DoxyCodeLine{00504                     \_vScrollBar.Value = \_vScrollBar.Value + difference;}
\DoxyCodeLine{00505                 \}}
\DoxyCodeLine{00506             \}}
\DoxyCodeLine{00507 }
\DoxyCodeLine{00508             \textcolor{keywordflow}{if} (\_hScrollBar.Visible)}
\DoxyCodeLine{00509             \{}
\DoxyCodeLine{00510                 \textcolor{comment}{// Scroll left}}
\DoxyCodeLine{00511                 \textcolor{keywordflow}{if} (pos.X < ClientRectangle.Left)}
\DoxyCodeLine{00512                 \{}
\DoxyCodeLine{00513                     var difference = (pos.X -\/ ClientRectangle.Left) * -\/1;}
\DoxyCodeLine{00514 }
\DoxyCodeLine{00515                     \textcolor{keywordflow}{if} (difference > ItemHeight)}
\DoxyCodeLine{00516                         difference = ItemHeight;}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00518                     \_hScrollBar.Value = \_hScrollBar.Value -\/ difference;}
\DoxyCodeLine{00519                 \}}
\DoxyCodeLine{00520 }
\DoxyCodeLine{00521                 \textcolor{comment}{// Scroll right}}
\DoxyCodeLine{00522                 \textcolor{keywordflow}{if} (pos.X > ClientRectangle.Right)}
\DoxyCodeLine{00523                 \{}
\DoxyCodeLine{00524                     var difference = pos.X -\/ ClientRectangle.Right;}
\DoxyCodeLine{00525 }
\DoxyCodeLine{00526                     \textcolor{keywordflow}{if} (difference > ItemHeight)}
\DoxyCodeLine{00527                         difference = ItemHeight;}
\DoxyCodeLine{00528 }
\DoxyCodeLine{00529                     \_hScrollBar.Value = \_hScrollBar.Value + difference;}
\DoxyCodeLine{00530                 \}}
\DoxyCodeLine{00531             \}}
\DoxyCodeLine{00532         \}}
\DoxyCodeLine{00533 }
\DoxyCodeLine{00534 \textcolor{preprocessor}{        \#endregion Event Handler Region}}
\DoxyCodeLine{00535 }
\DoxyCodeLine{00536 \textcolor{preprocessor}{        \#region Method Region}}
\DoxyCodeLine{00537 }
\DoxyCodeLine{00538         \textcolor{keyword}{private} \textcolor{keywordtype}{void} HookNodeEvents(VitNX\_TreeNode node)}
\DoxyCodeLine{00539         \{}
\DoxyCodeLine{00540             node.Nodes.ItemsAdded += ChildNodes\_ItemsAdded;}
\DoxyCodeLine{00541             node.Nodes.ItemsRemoved += ChildNodes\_ItemsRemoved;}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543             node.TextChanged += Nodes\_TextChanged;}
\DoxyCodeLine{00544             node.NodeExpanded += Nodes\_NodeExpanded;}
\DoxyCodeLine{00545             node.NodeCollapsed += Nodes\_NodeCollapsed;}
\DoxyCodeLine{00546 }
\DoxyCodeLine{00547             \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00548                 HookNodeEvents(childNode);}
\DoxyCodeLine{00549         \}}
\DoxyCodeLine{00550 }
\DoxyCodeLine{00551         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UnhookNodeEvents(VitNX\_TreeNode node)}
\DoxyCodeLine{00552         \{}
\DoxyCodeLine{00553             node.Nodes.ItemsAdded -\/= ChildNodes\_ItemsAdded;}
\DoxyCodeLine{00554             node.Nodes.ItemsRemoved -\/= ChildNodes\_ItemsRemoved;}
\DoxyCodeLine{00555 }
\DoxyCodeLine{00556             node.TextChanged -\/= Nodes\_TextChanged;}
\DoxyCodeLine{00557             node.NodeExpanded -\/= Nodes\_NodeExpanded;}
\DoxyCodeLine{00558             node.NodeCollapsed -\/= Nodes\_NodeCollapsed;}
\DoxyCodeLine{00559 }
\DoxyCodeLine{00560             \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00561                 UnhookNodeEvents(childNode);}
\DoxyCodeLine{00562         \}}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateNodes()}
\DoxyCodeLine{00565         \{}
\DoxyCodeLine{00566             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00567                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00568 }
\DoxyCodeLine{00569             ContentSize = \textcolor{keyword}{new} Size(0, 0);}
\DoxyCodeLine{00570 }
\DoxyCodeLine{00571             \textcolor{keywordflow}{if} (Nodes.Count == 0)}
\DoxyCodeLine{00572                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00573 }
\DoxyCodeLine{00574             var yOffset = 0;}
\DoxyCodeLine{00575             var isOdd = \textcolor{keyword}{false};}
\DoxyCodeLine{00576             var index = 0;}
\DoxyCodeLine{00577             VitNX\_TreeNode prevNode = \textcolor{keyword}{null};}
\DoxyCodeLine{00578 }
\DoxyCodeLine{00579             \textcolor{keywordflow}{for} (var i = 0; i <= Nodes.Count -\/ 1; i++)}
\DoxyCodeLine{00580             \{}
\DoxyCodeLine{00581                 var node = Nodes[i];}
\DoxyCodeLine{00582                 UpdateNode(node, ref prevNode, 0, ref yOffset, ref isOdd, ref index);}
\DoxyCodeLine{00583             \}}
\DoxyCodeLine{00584 }
\DoxyCodeLine{00585             ContentSize = \textcolor{keyword}{new} Size(ContentSize.Width, yOffset);}
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587             VisibleNodeCount = index;}
\DoxyCodeLine{00588 }
\DoxyCodeLine{00589             Invalidate();}
\DoxyCodeLine{00590         \}}
\DoxyCodeLine{00591 }
\DoxyCodeLine{00592         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateNode(VitNX\_TreeNode node, ref VitNX\_TreeNode prevNode, \textcolor{keywordtype}{int} indent, ref \textcolor{keywordtype}{int} yOffset,}
\DoxyCodeLine{00593                                 ref \textcolor{keywordtype}{bool} isOdd, ref \textcolor{keywordtype}{int} index)}
\DoxyCodeLine{00594         \{}
\DoxyCodeLine{00595             UpdateNodeBounds(node, yOffset, indent);}
\DoxyCodeLine{00596 }
\DoxyCodeLine{00597             yOffset += ItemHeight;}
\DoxyCodeLine{00598 }
\DoxyCodeLine{00599             node.Odd = isOdd;}
\DoxyCodeLine{00600             isOdd = !isOdd;}
\DoxyCodeLine{00601 }
\DoxyCodeLine{00602             node.VisibleIndex = index;}
\DoxyCodeLine{00603             index++;}
\DoxyCodeLine{00604 }
\DoxyCodeLine{00605             node.PrevVisibleNode = prevNode;}
\DoxyCodeLine{00606 }
\DoxyCodeLine{00607             \textcolor{keywordflow}{if} (prevNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00608                 prevNode.NextVisibleNode = node;}
\DoxyCodeLine{00609 }
\DoxyCodeLine{00610             prevNode = node;}
\DoxyCodeLine{00611 }
\DoxyCodeLine{00612             \textcolor{keywordflow}{if} (node.Expanded)}
\DoxyCodeLine{00613             \{}
\DoxyCodeLine{00614                 \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00615                     UpdateNode(childNode, ref prevNode, indent + Indent, ref yOffset, ref isOdd, ref index);}
\DoxyCodeLine{00616             \}}
\DoxyCodeLine{00617         \}}
\DoxyCodeLine{00618 }
\DoxyCodeLine{00619         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateNodeBounds(VitNX\_TreeNode node, \textcolor{keywordtype}{int} yOffset, \textcolor{keywordtype}{int} indent)}
\DoxyCodeLine{00620         \{}
\DoxyCodeLine{00621             var expandTop = yOffset + (ItemHeight / 2) -\/ (\_expandAreaSize / 2);}
\DoxyCodeLine{00622             node.ExpandArea = \textcolor{keyword}{new} Rectangle(indent + 3, expandTop, \_expandAreaSize, \_expandAreaSize);}
\DoxyCodeLine{00623 }
\DoxyCodeLine{00624             var iconTop = yOffset + (ItemHeight / 2) -\/ (\_iconSize / 2);}
\DoxyCodeLine{00625 }
\DoxyCodeLine{00626             \textcolor{keywordflow}{if} (ShowIcons)}
\DoxyCodeLine{00627                 node.IconArea = \textcolor{keyword}{new} Rectangle(node.ExpandArea.Right + 2, iconTop, \_iconSize, \_iconSize);}
\DoxyCodeLine{00628             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00629                 node.IconArea = \textcolor{keyword}{new} Rectangle(node.ExpandArea.Right, iconTop, 0, 0);}
\DoxyCodeLine{00630 }
\DoxyCodeLine{00631             \textcolor{keyword}{using} (var g = CreateGraphics())}
\DoxyCodeLine{00632             \{}
\DoxyCodeLine{00633                 var textSize = (int)(g.MeasureString(node.Text, Font).Width);}
\DoxyCodeLine{00634                 node.TextArea = \textcolor{keyword}{new} Rectangle(node.IconArea.Right + 2, yOffset, textSize + 1, ItemHeight);}
\DoxyCodeLine{00635             \}}
\DoxyCodeLine{00636 }
\DoxyCodeLine{00637             node.FullArea = \textcolor{keyword}{new} Rectangle(indent, yOffset, (node.TextArea.Right -\/ indent), ItemHeight);}
\DoxyCodeLine{00638 }
\DoxyCodeLine{00639             \textcolor{keywordflow}{if} (ContentSize.Width < node.TextArea.Right + 2)}
\DoxyCodeLine{00640                 ContentSize = \textcolor{keyword}{new} Size(node.TextArea.Right + 2, ContentSize.Height);}
\DoxyCodeLine{00641         \}}
\DoxyCodeLine{00642 }
\DoxyCodeLine{00643         \textcolor{keyword}{private} \textcolor{keywordtype}{void} LoadIcons()}
\DoxyCodeLine{00644         \{}
\DoxyCodeLine{00645             DisposeIcons();}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647             \_nodeClosed = TreeViewIcons.node\_closed\_empty.SetColor(Colors.LightText);}
\DoxyCodeLine{00648             \_nodeClosedHover = TreeViewIcons.node\_closed\_empty.SetColor(Colors.BlueHighlight);}
\DoxyCodeLine{00649             \_nodeClosedHoverSelected = TreeViewIcons.node\_closed\_full.SetColor(Colors.LightText);}
\DoxyCodeLine{00650             \_nodeOpen = TreeViewIcons.node\_open.SetColor(Colors.LightText);}
\DoxyCodeLine{00651             \_nodeOpenHover = TreeViewIcons.node\_open.SetColor(Colors.BlueHighlight);}
\DoxyCodeLine{00652             \_nodeOpenHoverSelected = TreeViewIcons.node\_open\_empty.SetColor(Colors.LightText);}
\DoxyCodeLine{00653         \}}
\DoxyCodeLine{00654 }
\DoxyCodeLine{00655         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DisposeIcons()}
\DoxyCodeLine{00656         \{}
\DoxyCodeLine{00657             \textcolor{keywordflow}{if} (\_nodeClosed != \textcolor{keyword}{null})}
\DoxyCodeLine{00658                 \_nodeClosed.Dispose();}
\DoxyCodeLine{00659 }
\DoxyCodeLine{00660             \textcolor{keywordflow}{if} (\_nodeClosedHover != \textcolor{keyword}{null})}
\DoxyCodeLine{00661                 \_nodeClosedHover.Dispose();}
\DoxyCodeLine{00662 }
\DoxyCodeLine{00663             \textcolor{keywordflow}{if} (\_nodeClosedHoverSelected != \textcolor{keyword}{null})}
\DoxyCodeLine{00664                 \_nodeClosedHoverSelected.Dispose();}
\DoxyCodeLine{00665 }
\DoxyCodeLine{00666             \textcolor{keywordflow}{if} (\_nodeOpen != \textcolor{keyword}{null})}
\DoxyCodeLine{00667                 \_nodeOpen.Dispose();}
\DoxyCodeLine{00668 }
\DoxyCodeLine{00669             \textcolor{keywordflow}{if} (\_nodeOpenHover != \textcolor{keyword}{null})}
\DoxyCodeLine{00670                 \_nodeOpenHover.Dispose();}
\DoxyCodeLine{00671 }
\DoxyCodeLine{00672             \textcolor{keywordflow}{if} (\_nodeOpenHoverSelected != \textcolor{keyword}{null})}
\DoxyCodeLine{00673                 \_nodeOpenHoverSelected.Dispose();}
\DoxyCodeLine{00674         \}}
\DoxyCodeLine{00675 }
\DoxyCodeLine{00676         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckHover()}
\DoxyCodeLine{00677         \{}
\DoxyCodeLine{00678             \textcolor{keywordflow}{if} (!ClientRectangle.Contains(PointToClient(MousePosition)))}
\DoxyCodeLine{00679             \{}
\DoxyCodeLine{00680                 \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00681                 \{}
\DoxyCodeLine{00682                     \textcolor{keywordflow}{if} (\_dropNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00683                     \{}
\DoxyCodeLine{00684                         \_dropNode = \textcolor{keyword}{null};}
\DoxyCodeLine{00685                         Invalidate();}
\DoxyCodeLine{00686                     \}}
\DoxyCodeLine{00687                 \}}
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00690             \}}
\DoxyCodeLine{00691 }
\DoxyCodeLine{00692             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00693                 CheckNodeHover(node, OffsetMousePosition);}
\DoxyCodeLine{00694         \}}
\DoxyCodeLine{00695 }
\DoxyCodeLine{00696         \textcolor{keyword}{private} \textcolor{keywordtype}{void} NodeMouseLeave(VitNX\_TreeNode node)}
\DoxyCodeLine{00697         \{}
\DoxyCodeLine{00698             node.ExpandAreaHot = \textcolor{keyword}{false};}
\DoxyCodeLine{00699 }
\DoxyCodeLine{00700             \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00701                 NodeMouseLeave(childNode);}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00703             Invalidate();}
\DoxyCodeLine{00704         \}}
\DoxyCodeLine{00705 }
\DoxyCodeLine{00706         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckNodeHover(VitNX\_TreeNode node, Point location)}
\DoxyCodeLine{00707         \{}
\DoxyCodeLine{00708             \textcolor{keywordflow}{if} (IsDragging)}
\DoxyCodeLine{00709             \{}
\DoxyCodeLine{00710                 var rect = GetNodeFullRowArea(node);}
\DoxyCodeLine{00711                 \textcolor{keywordflow}{if} (rect.Contains(OffsetMousePosition))}
\DoxyCodeLine{00712                 \{}
\DoxyCodeLine{00713                     var newDropNode = \_dragNodes.Contains(node) ? null : node;}
\DoxyCodeLine{00714 }
\DoxyCodeLine{00715                     \textcolor{keywordflow}{if} (\_dropNode != newDropNode)}
\DoxyCodeLine{00716                     \{}
\DoxyCodeLine{00717                         \_dropNode = newDropNode;}
\DoxyCodeLine{00718                         Invalidate();}
\DoxyCodeLine{00719                     \}}
\DoxyCodeLine{00720                 \}}
\DoxyCodeLine{00721             \}}
\DoxyCodeLine{00722             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00723             \{}
\DoxyCodeLine{00724                 var hot = node.ExpandArea.Contains(location);}
\DoxyCodeLine{00725                 \textcolor{keywordflow}{if} (node.ExpandAreaHot != hot)}
\DoxyCodeLine{00726                 \{}
\DoxyCodeLine{00727                     node.ExpandAreaHot = hot;}
\DoxyCodeLine{00728                     Invalidate();}
\DoxyCodeLine{00729                 \}}
\DoxyCodeLine{00730             \}}
\DoxyCodeLine{00731 }
\DoxyCodeLine{00732             \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00733                 CheckNodeHover(childNode, location);}
\DoxyCodeLine{00734         \}}
\DoxyCodeLine{00735 }
\DoxyCodeLine{00736         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckNodeClick(VitNX\_TreeNode node, Point location, MouseButtons button)}
\DoxyCodeLine{00737         \{}
\DoxyCodeLine{00738             var rect = GetNodeFullRowArea(node);}
\DoxyCodeLine{00739             \textcolor{keywordflow}{if} (rect.Contains(location))}
\DoxyCodeLine{00740             \{}
\DoxyCodeLine{00741                 \textcolor{keywordflow}{if} (node.ExpandArea.Contains(location))}
\DoxyCodeLine{00742                 \{}
\DoxyCodeLine{00743                     \textcolor{keywordflow}{if} (button == MouseButtons.Left)}
\DoxyCodeLine{00744                         node.Expanded = !node.Expanded;}
\DoxyCodeLine{00745                 \}}
\DoxyCodeLine{00746                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{00747                 \{}
\DoxyCodeLine{00748                     \textcolor{keywordflow}{if} (button == MouseButtons.Left)}
\DoxyCodeLine{00749                     \{}
\DoxyCodeLine{00750                         \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Shift)}
\DoxyCodeLine{00751                         \{}
\DoxyCodeLine{00752                             SelectAnchoredRange(node);}
\DoxyCodeLine{00753                         \}}
\DoxyCodeLine{00754                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Control)}
\DoxyCodeLine{00755                         \{}
\DoxyCodeLine{00756                             ToggleNode(node);}
\DoxyCodeLine{00757                         \}}
\DoxyCodeLine{00758                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{00759                         \{}
\DoxyCodeLine{00760                             \textcolor{keywordflow}{if} (!SelectedNodes.Contains(node))}
\DoxyCodeLine{00761                                 SelectNode(node);}
\DoxyCodeLine{00762 }
\DoxyCodeLine{00763                             \_dragPos = OffsetMousePosition;}
\DoxyCodeLine{00764                             \_provisionalDragging = \textcolor{keyword}{true};}
\DoxyCodeLine{00765                             \_provisionalNode = node;}
\DoxyCodeLine{00766                         \}}
\DoxyCodeLine{00767 }
\DoxyCodeLine{00768                         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00769                     \}}
\DoxyCodeLine{00770                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (button == MouseButtons.Right)}
\DoxyCodeLine{00771                     \{}
\DoxyCodeLine{00772                         \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Shift)}
\DoxyCodeLine{00773                             \textcolor{keywordflow}{return};}
\DoxyCodeLine{00774 }
\DoxyCodeLine{00775                         \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Control)}
\DoxyCodeLine{00776                             \textcolor{keywordflow}{return};}
\DoxyCodeLine{00777 }
\DoxyCodeLine{00778                         \textcolor{keywordflow}{if} (!SelectedNodes.Contains(node))}
\DoxyCodeLine{00779                             SelectNode(node);}
\DoxyCodeLine{00780 }
\DoxyCodeLine{00781                         \textcolor{keywordflow}{return};}
\DoxyCodeLine{00782                     \}}
\DoxyCodeLine{00783                 \}}
\DoxyCodeLine{00784             \}}
\DoxyCodeLine{00785 }
\DoxyCodeLine{00786             \textcolor{keywordflow}{if} (node.Expanded)}
\DoxyCodeLine{00787             \{}
\DoxyCodeLine{00788                 \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00789                     CheckNodeClick(childNode, location, button);}
\DoxyCodeLine{00790             \}}
\DoxyCodeLine{00791         \}}
\DoxyCodeLine{00792 }
\DoxyCodeLine{00793         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckNodeDoubleClick(VitNX\_TreeNode node, Point location)}
\DoxyCodeLine{00794         \{}
\DoxyCodeLine{00795             var rect = GetNodeFullRowArea(node);}
\DoxyCodeLine{00796             \textcolor{keywordflow}{if} (rect.Contains(location))}
\DoxyCodeLine{00797             \{}
\DoxyCodeLine{00798                 \textcolor{keywordflow}{if} (!node.ExpandArea.Contains(location))}
\DoxyCodeLine{00799                     node.Expanded = !node.Expanded;}
\DoxyCodeLine{00800 }
\DoxyCodeLine{00801                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00802             \}}
\DoxyCodeLine{00803 }
\DoxyCodeLine{00804             \textcolor{keywordflow}{if} (node.Expanded)}
\DoxyCodeLine{00805             \{}
\DoxyCodeLine{00806                 \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00807                     CheckNodeDoubleClick(childNode, location);}
\DoxyCodeLine{00808             \}}
\DoxyCodeLine{00809         \}}
\DoxyCodeLine{00810 }
\DoxyCodeLine{00811         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectNode(VitNX\_TreeNode node)}
\DoxyCodeLine{00812         \{}
\DoxyCodeLine{00813             \_selectedNodes.Clear();}
\DoxyCodeLine{00814             \_selectedNodes.Add(node);}
\DoxyCodeLine{00815 }
\DoxyCodeLine{00816             \_anchoredNodeStart = node;}
\DoxyCodeLine{00817             \_anchoredNodeEnd = node;}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819             Invalidate();}
\DoxyCodeLine{00820         \}}
\DoxyCodeLine{00821 }
\DoxyCodeLine{00822         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectNodes(VitNX\_TreeNode startNode, VitNX\_TreeNode endNode)}
\DoxyCodeLine{00823         \{}
\DoxyCodeLine{00824             var nodes = \textcolor{keyword}{new} List<VitNX\_TreeNode>();}
\DoxyCodeLine{00825 }
\DoxyCodeLine{00826             \textcolor{keywordflow}{if} (startNode == endNode)}
\DoxyCodeLine{00827                 nodes.Add(startNode);}
\DoxyCodeLine{00828 }
\DoxyCodeLine{00829             \textcolor{keywordflow}{if} (startNode.VisibleIndex < endNode.VisibleIndex)}
\DoxyCodeLine{00830             \{}
\DoxyCodeLine{00831                 var node = startNode;}
\DoxyCodeLine{00832                 nodes.Add(node);}
\DoxyCodeLine{00833                 \textcolor{keywordflow}{while} (node != endNode \&\& node != \textcolor{keyword}{null})}
\DoxyCodeLine{00834                 \{}
\DoxyCodeLine{00835                     node = node.NextVisibleNode;}
\DoxyCodeLine{00836                     nodes.Add(node);}
\DoxyCodeLine{00837                 \}}
\DoxyCodeLine{00838             \}}
\DoxyCodeLine{00839             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (startNode.VisibleIndex > endNode.VisibleIndex)}
\DoxyCodeLine{00840             \{}
\DoxyCodeLine{00841                 var node = startNode;}
\DoxyCodeLine{00842                 nodes.Add(node);}
\DoxyCodeLine{00843                 \textcolor{keywordflow}{while} (node != endNode \&\& node != \textcolor{keyword}{null})}
\DoxyCodeLine{00844                 \{}
\DoxyCodeLine{00845                     node = node.PrevVisibleNode;}
\DoxyCodeLine{00846                     nodes.Add(node);}
\DoxyCodeLine{00847                 \}}
\DoxyCodeLine{00848             \}}
\DoxyCodeLine{00849 }
\DoxyCodeLine{00850             SelectNodes(nodes, \textcolor{keyword}{false});}
\DoxyCodeLine{00851         \}}
\DoxyCodeLine{00852 }
\DoxyCodeLine{00853         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectNodes(List<VitNX\_TreeNode> nodes, \textcolor{keywordtype}{bool} updateAnchors = \textcolor{keyword}{true})}
\DoxyCodeLine{00854         \{}
\DoxyCodeLine{00855             \_selectedNodes.Clear();}
\DoxyCodeLine{00856 }
\DoxyCodeLine{00857             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} nodes)}
\DoxyCodeLine{00858                 \_selectedNodes.Add(node);}
\DoxyCodeLine{00859 }
\DoxyCodeLine{00860             \textcolor{keywordflow}{if} (updateAnchors \&\& \_selectedNodes.Count > 0)}
\DoxyCodeLine{00861             \{}
\DoxyCodeLine{00862                 \_anchoredNodeStart = \_selectedNodes[\_selectedNodes.Count -\/ 1];}
\DoxyCodeLine{00863                 \_anchoredNodeEnd = \_selectedNodes[\_selectedNodes.Count -\/ 1];}
\DoxyCodeLine{00864             \}}
\DoxyCodeLine{00865 }
\DoxyCodeLine{00866             Invalidate();}
\DoxyCodeLine{00867         \}}
\DoxyCodeLine{00868 }
\DoxyCodeLine{00869         \textcolor{keyword}{private} \textcolor{keywordtype}{void} SelectAnchoredRange(VitNX\_TreeNode node)}
\DoxyCodeLine{00870         \{}
\DoxyCodeLine{00871             \_anchoredNodeEnd = node;}
\DoxyCodeLine{00872             SelectNodes(\_anchoredNodeStart, \_anchoredNodeEnd);}
\DoxyCodeLine{00873         \}}
\DoxyCodeLine{00874 }
\DoxyCodeLine{00875         \textcolor{keyword}{public} \textcolor{keywordtype}{void} ToggleNode(VitNX\_TreeNode node)}
\DoxyCodeLine{00876         \{}
\DoxyCodeLine{00877             \textcolor{keywordflow}{if} (\_selectedNodes.Contains(node))}
\DoxyCodeLine{00878             \{}
\DoxyCodeLine{00879                 \_selectedNodes.Remove(node);}
\DoxyCodeLine{00880 }
\DoxyCodeLine{00881                 \textcolor{comment}{// If we just removed both the anchor start AND end then reset them}}
\DoxyCodeLine{00882                 \textcolor{keywordflow}{if} (\_anchoredNodeStart == node \&\& \_anchoredNodeEnd == node)}
\DoxyCodeLine{00883                 \{}
\DoxyCodeLine{00884                     \textcolor{keywordflow}{if} (\_selectedNodes.Count > 0)}
\DoxyCodeLine{00885                     \{}
\DoxyCodeLine{00886                         \_anchoredNodeStart = \_selectedNodes[0];}
\DoxyCodeLine{00887                         \_anchoredNodeEnd = \_selectedNodes[0];}
\DoxyCodeLine{00888                     \}}
\DoxyCodeLine{00889                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00890                     \{}
\DoxyCodeLine{00891                         \_anchoredNodeStart = \textcolor{keyword}{null};}
\DoxyCodeLine{00892                         \_anchoredNodeEnd = \textcolor{keyword}{null};}
\DoxyCodeLine{00893                     \}}
\DoxyCodeLine{00894                 \}}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896                 \textcolor{comment}{// If we just removed the anchor start then update it accordingly}}
\DoxyCodeLine{00897                 \textcolor{keywordflow}{if} (\_anchoredNodeStart == node)}
\DoxyCodeLine{00898                 \{}
\DoxyCodeLine{00899                     \textcolor{keywordflow}{if} (\_anchoredNodeEnd.VisibleIndex < node.VisibleIndex)}
\DoxyCodeLine{00900                         \_anchoredNodeStart = node.PrevVisibleNode;}
\DoxyCodeLine{00901                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\_anchoredNodeEnd.VisibleIndex > node.VisibleIndex)}
\DoxyCodeLine{00902                         \_anchoredNodeStart = node.NextVisibleNode;}
\DoxyCodeLine{00903                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00904                         \_anchoredNodeStart = \_anchoredNodeEnd;}
\DoxyCodeLine{00905                 \}}
\DoxyCodeLine{00906 }
\DoxyCodeLine{00907                 \textcolor{comment}{// If we just removed the anchor end then update it accordingly}}
\DoxyCodeLine{00908                 \textcolor{keywordflow}{if} (\_anchoredNodeEnd == node)}
\DoxyCodeLine{00909                 \{}
\DoxyCodeLine{00910                     \textcolor{keywordflow}{if} (\_anchoredNodeStart.VisibleIndex < node.VisibleIndex)}
\DoxyCodeLine{00911                         \_anchoredNodeEnd = node.PrevVisibleNode;}
\DoxyCodeLine{00912                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\_anchoredNodeStart.VisibleIndex > node.VisibleIndex)}
\DoxyCodeLine{00913                         \_anchoredNodeEnd = node.NextVisibleNode;}
\DoxyCodeLine{00914                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00915                         \_anchoredNodeEnd = \_anchoredNodeStart;}
\DoxyCodeLine{00916                 \}}
\DoxyCodeLine{00917             \}}
\DoxyCodeLine{00918             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00919             \{}
\DoxyCodeLine{00920                 \_selectedNodes.Add(node);}
\DoxyCodeLine{00921 }
\DoxyCodeLine{00922                 \_anchoredNodeStart = node;}
\DoxyCodeLine{00923                 \_anchoredNodeEnd = node;}
\DoxyCodeLine{00924             \}}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926             Invalidate();}
\DoxyCodeLine{00927         \}}
\DoxyCodeLine{00928 }
\DoxyCodeLine{00929         \textcolor{keyword}{public} Rectangle GetNodeFullRowArea(VitNX\_TreeNode node)}
\DoxyCodeLine{00930         \{}
\DoxyCodeLine{00931             \textcolor{keywordflow}{if} (node.ParentNode != \textcolor{keyword}{null} \&\& !node.ParentNode.Expanded)}
\DoxyCodeLine{00932                 \textcolor{keywordflow}{return} \textcolor{keyword}{new} Rectangle(-\/1, -\/1, -\/1, -\/1);}
\DoxyCodeLine{00933 }
\DoxyCodeLine{00934             var width = Math.Max(ContentSize.Width, Viewport.Width);}
\DoxyCodeLine{00935             var rect = \textcolor{keyword}{new} Rectangle(0, node.FullArea.Top, width, ItemHeight);}
\DoxyCodeLine{00936             \textcolor{keywordflow}{return} rect;}
\DoxyCodeLine{00937         \}}
\DoxyCodeLine{00938 }
\DoxyCodeLine{00939         \textcolor{keyword}{public} \textcolor{keywordtype}{void} EnsureVisible()}
\DoxyCodeLine{00940         \{}
\DoxyCodeLine{00941             \textcolor{keywordflow}{if} (SelectedNodes.Count == 0)}
\DoxyCodeLine{00942                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} SelectedNodes)}
\DoxyCodeLine{00945                 node.EnsureVisible();}
\DoxyCodeLine{00946 }
\DoxyCodeLine{00947             var itemTop = -\/1;}
\DoxyCodeLine{00948 }
\DoxyCodeLine{00949             \textcolor{keywordflow}{if} (!MultiSelect)}
\DoxyCodeLine{00950                 itemTop = SelectedNodes[0].FullArea.Top;}
\DoxyCodeLine{00951             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00952                 itemTop = \_anchoredNodeEnd.FullArea.Top;}
\DoxyCodeLine{00953 }
\DoxyCodeLine{00954             var itemBottom = itemTop + ItemHeight;}
\DoxyCodeLine{00955 }
\DoxyCodeLine{00956             \textcolor{keywordflow}{if} (itemTop < Viewport.Top)}
\DoxyCodeLine{00957                 VScrollTo(itemTop);}
\DoxyCodeLine{00958 }
\DoxyCodeLine{00959             \textcolor{keywordflow}{if} (itemBottom > Viewport.Bottom)}
\DoxyCodeLine{00960                 VScrollTo((itemBottom -\/ Viewport.Height));}
\DoxyCodeLine{00961         \}}
\DoxyCodeLine{00962 }
\DoxyCodeLine{00963         \textcolor{keyword}{public} \textcolor{keywordtype}{void} Sort()}
\DoxyCodeLine{00964         \{}
\DoxyCodeLine{00965             \textcolor{keywordflow}{if} (TreeViewNodeSorter == \textcolor{keyword}{null})}
\DoxyCodeLine{00966                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00967 }
\DoxyCodeLine{00968             Nodes.Sort(TreeViewNodeSorter);}
\DoxyCodeLine{00969 }
\DoxyCodeLine{00970             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00971                 SortChildNodes(node);}
\DoxyCodeLine{00972         \}}
\DoxyCodeLine{00973 }
\DoxyCodeLine{00974         \textcolor{keyword}{private} \textcolor{keywordtype}{void} SortChildNodes(VitNX\_TreeNode node)}
\DoxyCodeLine{00975         \{}
\DoxyCodeLine{00976             node.Nodes.Sort(TreeViewNodeSorter);}
\DoxyCodeLine{00977 }
\DoxyCodeLine{00978             \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{00979                 SortChildNodes(childNode);}
\DoxyCodeLine{00980         \}}
\DoxyCodeLine{00981 }
\DoxyCodeLine{00982         \textcolor{keyword}{public} VitNX\_TreeNode FindNode(\textcolor{keywordtype}{string} path)}
\DoxyCodeLine{00983         \{}
\DoxyCodeLine{00984             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{00985             \{}
\DoxyCodeLine{00986                 var compNode = FindNode(node, path);}
\DoxyCodeLine{00987                 \textcolor{keywordflow}{if} (compNode != \textcolor{keyword}{null})}
\DoxyCodeLine{00988                     \textcolor{keywordflow}{return} compNode;}
\DoxyCodeLine{00989             \}}
\DoxyCodeLine{00990 }
\DoxyCodeLine{00991             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00992         \}}
\DoxyCodeLine{00993 }
\DoxyCodeLine{00994         \textcolor{keyword}{private} VitNX\_TreeNode FindNode(VitNX\_TreeNode parentNode, \textcolor{keywordtype}{string} path, \textcolor{keywordtype}{bool} recursive = \textcolor{keyword}{true})}
\DoxyCodeLine{00995         \{}
\DoxyCodeLine{00996             \textcolor{keywordflow}{if} (parentNode.FullPath == path)}
\DoxyCodeLine{00997                 \textcolor{keywordflow}{return} parentNode;}
\DoxyCodeLine{00998 }
\DoxyCodeLine{00999             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} parentNode.Nodes)}
\DoxyCodeLine{01000             \{}
\DoxyCodeLine{01001                 \textcolor{keywordflow}{if} (node.FullPath == path)}
\DoxyCodeLine{01002                     \textcolor{keywordflow}{return} node;}
\DoxyCodeLine{01003 }
\DoxyCodeLine{01004                 \textcolor{keywordflow}{if} (recursive)}
\DoxyCodeLine{01005                 \{}
\DoxyCodeLine{01006                     var compNode = FindNode(node, path);}
\DoxyCodeLine{01007                     \textcolor{keywordflow}{if} (compNode != \textcolor{keyword}{null})}
\DoxyCodeLine{01008                         \textcolor{keywordflow}{return} compNode;}
\DoxyCodeLine{01009                 \}}
\DoxyCodeLine{01010             \}}
\DoxyCodeLine{01011 }
\DoxyCodeLine{01012             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{01013         \}}
\DoxyCodeLine{01014 }
\DoxyCodeLine{01015 \textcolor{preprocessor}{        \#endregion Method Region}}
\DoxyCodeLine{01016 }
\DoxyCodeLine{01017 \textcolor{preprocessor}{        \#region Drag \& Drop Region}}
\DoxyCodeLine{01018 }
\DoxyCodeLine{01019         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} StartDrag()}
\DoxyCodeLine{01020         \{}
\DoxyCodeLine{01021             \textcolor{keywordflow}{if} (!AllowMoveNodes)}
\DoxyCodeLine{01022             \{}
\DoxyCodeLine{01023                 \_provisionalDragging = \textcolor{keyword}{false};}
\DoxyCodeLine{01024                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01025             \}}
\DoxyCodeLine{01026 }
\DoxyCodeLine{01027             \textcolor{comment}{// Create initial list of nodes to drag}}
\DoxyCodeLine{01028             \_dragNodes = \textcolor{keyword}{new} List<VitNX\_TreeNode>();}
\DoxyCodeLine{01029             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} SelectedNodes)}
\DoxyCodeLine{01030                 \_dragNodes.Add(node);}
\DoxyCodeLine{01031 }
\DoxyCodeLine{01032             \textcolor{comment}{// Clear out any nodes with a parent that is being dragged}}
\DoxyCodeLine{01033             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} \_dragNodes.ToList())}
\DoxyCodeLine{01034             \{}
\DoxyCodeLine{01035                 \textcolor{keywordflow}{if} (node.ParentNode == \textcolor{keyword}{null})}
\DoxyCodeLine{01036                     \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01037 }
\DoxyCodeLine{01038                 \textcolor{keywordflow}{if} (\_dragNodes.Contains(node.ParentNode))}
\DoxyCodeLine{01039                     \_dragNodes.Remove(node);}
\DoxyCodeLine{01040             \}}
\DoxyCodeLine{01041 }
\DoxyCodeLine{01042             \_provisionalDragging = \textcolor{keyword}{false};}
\DoxyCodeLine{01043 }
\DoxyCodeLine{01044             Cursor = Cursors.SizeAll;}
\DoxyCodeLine{01045 }
\DoxyCodeLine{01046             base.StartDrag();}
\DoxyCodeLine{01047         \}}
\DoxyCodeLine{01048 }
\DoxyCodeLine{01049         \textcolor{keyword}{private} \textcolor{keywordtype}{void} HandleDrag()}
\DoxyCodeLine{01050         \{}
\DoxyCodeLine{01051             \textcolor{keywordflow}{if} (!AllowMoveNodes)}
\DoxyCodeLine{01052                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01053 }
\DoxyCodeLine{01054             var dropNode = \_dropNode;}
\DoxyCodeLine{01055 }
\DoxyCodeLine{01056             \textcolor{keywordflow}{if} (dropNode == \textcolor{keyword}{null})}
\DoxyCodeLine{01057             \{}
\DoxyCodeLine{01058                 \textcolor{keywordflow}{if} (Cursor != Cursors.No)}
\DoxyCodeLine{01059                     Cursor = Cursors.No;}
\DoxyCodeLine{01060 }
\DoxyCodeLine{01061                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01062             \}}
\DoxyCodeLine{01063 }
\DoxyCodeLine{01064             \textcolor{keywordflow}{if} (ForceDropToParent(dropNode))}
\DoxyCodeLine{01065                 dropNode = dropNode.ParentNode;}
\DoxyCodeLine{01066 }
\DoxyCodeLine{01067             \textcolor{keywordflow}{if} (!CanMoveNodes(\_dragNodes, dropNode))}
\DoxyCodeLine{01068             \{}
\DoxyCodeLine{01069                 \textcolor{keywordflow}{if} (Cursor != Cursors.No)}
\DoxyCodeLine{01070                     Cursor = Cursors.No;}
\DoxyCodeLine{01071 }
\DoxyCodeLine{01072                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01073             \}}
\DoxyCodeLine{01074 }
\DoxyCodeLine{01075             \textcolor{keywordflow}{if} (Cursor != Cursors.SizeAll)}
\DoxyCodeLine{01076                 Cursor = Cursors.SizeAll;}
\DoxyCodeLine{01077         \}}
\DoxyCodeLine{01078 }
\DoxyCodeLine{01079         \textcolor{keyword}{private} \textcolor{keywordtype}{void} HandleDrop()}
\DoxyCodeLine{01080         \{}
\DoxyCodeLine{01081             \textcolor{keywordflow}{if} (!AllowMoveNodes)}
\DoxyCodeLine{01082                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01083 }
\DoxyCodeLine{01084             var dropNode = \_dropNode;}
\DoxyCodeLine{01085 }
\DoxyCodeLine{01086             \textcolor{keywordflow}{if} (dropNode == \textcolor{keyword}{null})}
\DoxyCodeLine{01087             \{}
\DoxyCodeLine{01088                 StopDrag();}
\DoxyCodeLine{01089                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{01090             \}}
\DoxyCodeLine{01091 }
\DoxyCodeLine{01092             \textcolor{keywordflow}{if} (ForceDropToParent(dropNode))}
\DoxyCodeLine{01093                 dropNode = dropNode.ParentNode;}
\DoxyCodeLine{01094 }
\DoxyCodeLine{01095             \textcolor{keywordflow}{if} (CanMoveNodes(\_dragNodes, dropNode, \textcolor{keyword}{true}))}
\DoxyCodeLine{01096             \{}
\DoxyCodeLine{01097                 var cachedSelectedNodes = SelectedNodes.ToList();}
\DoxyCodeLine{01098 }
\DoxyCodeLine{01099                 MoveNodes(\_dragNodes, dropNode);}
\DoxyCodeLine{01100 }
\DoxyCodeLine{01101                 \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} \_dragNodes)}
\DoxyCodeLine{01102                 \{}
\DoxyCodeLine{01103                     \textcolor{keywordflow}{if} (node.ParentNode == \textcolor{keyword}{null})}
\DoxyCodeLine{01104                         Nodes.Remove(node);}
\DoxyCodeLine{01105                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{01106                         node.ParentNode.Nodes.Remove(node);}
\DoxyCodeLine{01107 }
\DoxyCodeLine{01108                     dropNode.Nodes.Add(node);}
\DoxyCodeLine{01109                 \}}
\DoxyCodeLine{01110 }
\DoxyCodeLine{01111                 \textcolor{keywordflow}{if} (TreeViewNodeSorter != \textcolor{keyword}{null})}
\DoxyCodeLine{01112                     dropNode.Nodes.Sort(TreeViewNodeSorter);}
\DoxyCodeLine{01113 }
\DoxyCodeLine{01114                 dropNode.Expanded = \textcolor{keyword}{true};}
\DoxyCodeLine{01115 }
\DoxyCodeLine{01116                 NodesMoved(\_dragNodes);}
\DoxyCodeLine{01117 }
\DoxyCodeLine{01118                 \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} cachedSelectedNodes)}
\DoxyCodeLine{01119                     \_selectedNodes.Add(node);}
\DoxyCodeLine{01120             \}}
\DoxyCodeLine{01121 }
\DoxyCodeLine{01122             StopDrag();}
\DoxyCodeLine{01123             UpdateNodes();}
\DoxyCodeLine{01124         \}}
\DoxyCodeLine{01125 }
\DoxyCodeLine{01126         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} StopDrag()}
\DoxyCodeLine{01127         \{}
\DoxyCodeLine{01128             \_dragNodes = \textcolor{keyword}{null};}
\DoxyCodeLine{01129             \_dropNode = \textcolor{keyword}{null};}
\DoxyCodeLine{01130 }
\DoxyCodeLine{01131             Cursor = Cursors.Default;}
\DoxyCodeLine{01132 }
\DoxyCodeLine{01133             Invalidate();}
\DoxyCodeLine{01134 }
\DoxyCodeLine{01135             base.StopDrag();}
\DoxyCodeLine{01136         \}}
\DoxyCodeLine{01137 }
\DoxyCodeLine{01138         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} ForceDropToParent(VitNX\_TreeNode node)}
\DoxyCodeLine{01139         \{}
\DoxyCodeLine{01140             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01141         \}}
\DoxyCodeLine{01142 }
\DoxyCodeLine{01143         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} CanMoveNodes(List<VitNX\_TreeNode> dragNodes, VitNX\_TreeNode dropNode, \textcolor{keywordtype}{bool} isMoving = \textcolor{keyword}{false})}
\DoxyCodeLine{01144         \{}
\DoxyCodeLine{01145             \textcolor{keywordflow}{if} (dropNode == \textcolor{keyword}{null})}
\DoxyCodeLine{01146                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01147 }
\DoxyCodeLine{01148             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} dragNodes)}
\DoxyCodeLine{01149             \{}
\DoxyCodeLine{01150                 \textcolor{keywordflow}{if} (node == dropNode)}
\DoxyCodeLine{01151                 \{}
\DoxyCodeLine{01152                     \textcolor{keywordflow}{if} (isMoving)}
\DoxyCodeLine{01153                         VitNX\_MessageBox.ShowError(\$\textcolor{stringliteral}{"{}Cannot move \{node.Text\}. The destination folder is the same as the source folder."{}}, Application.ProductName);}
\DoxyCodeLine{01154 }
\DoxyCodeLine{01155                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01156                 \}}
\DoxyCodeLine{01157 }
\DoxyCodeLine{01158                 \textcolor{keywordflow}{if} (node.ParentNode != \textcolor{keyword}{null} \&\& node.ParentNode == dropNode)}
\DoxyCodeLine{01159                 \{}
\DoxyCodeLine{01160                     \textcolor{keywordflow}{if} (isMoving)}
\DoxyCodeLine{01161                         VitNX\_MessageBox.ShowError(\$\textcolor{stringliteral}{"{}Cannot move \{node.Text\}. The destination folder is the same as the source folder."{}}, Application.ProductName);}
\DoxyCodeLine{01162 }
\DoxyCodeLine{01163                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01164                 \}}
\DoxyCodeLine{01165 }
\DoxyCodeLine{01166                 var parentNode = dropNode.ParentNode;}
\DoxyCodeLine{01167                 \textcolor{keywordflow}{while} (parentNode != \textcolor{keyword}{null})}
\DoxyCodeLine{01168                 \{}
\DoxyCodeLine{01169                     \textcolor{keywordflow}{if} (node == parentNode)}
\DoxyCodeLine{01170                     \{}
\DoxyCodeLine{01171                         \textcolor{keywordflow}{if} (isMoving)}
\DoxyCodeLine{01172                             VitNX\_MessageBox.ShowError(\$\textcolor{stringliteral}{"{}Cannot move \{node.Text\}. The destination folder is a subfolder of the source folder."{}}, Application.ProductName);}
\DoxyCodeLine{01173 }
\DoxyCodeLine{01174                         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{01175                     \}}
\DoxyCodeLine{01176 }
\DoxyCodeLine{01177                     parentNode = parentNode.ParentNode;}
\DoxyCodeLine{01178                 \}}
\DoxyCodeLine{01179             \}}
\DoxyCodeLine{01180 }
\DoxyCodeLine{01181             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{01182         \}}
\DoxyCodeLine{01183 }
\DoxyCodeLine{01184         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} MoveNodes(List<VitNX\_TreeNode> dragNodes, VitNX\_TreeNode dropNode)}
\DoxyCodeLine{01185         \{ \}}
\DoxyCodeLine{01186 }
\DoxyCodeLine{01187         \textcolor{keyword}{protected} \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} NodesMoved(List<VitNX\_TreeNode> nodesMoved)}
\DoxyCodeLine{01188         \{ \}}
\DoxyCodeLine{01189 }
\DoxyCodeLine{01190 \textcolor{preprocessor}{        \#endregion Drag \& Drop Region}}
\DoxyCodeLine{01191 }
\DoxyCodeLine{01192 \textcolor{preprocessor}{        \#region Paint Region}}
\DoxyCodeLine{01193 }
\DoxyCodeLine{01194         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} PaintContent(Graphics g)}
\DoxyCodeLine{01195         \{}
\DoxyCodeLine{01196             \textcolor{keywordflow}{foreach} (var node \textcolor{keywordflow}{in} Nodes)}
\DoxyCodeLine{01197             \{}
\DoxyCodeLine{01198                 DrawNode(node, g);}
\DoxyCodeLine{01199             \}}
\DoxyCodeLine{01200         \}}
\DoxyCodeLine{01201 }
\DoxyCodeLine{01202         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DrawNode(VitNX\_TreeNode node, Graphics g)}
\DoxyCodeLine{01203         \{}
\DoxyCodeLine{01204             var rect = GetNodeFullRowArea(node);}
\DoxyCodeLine{01205 }
\DoxyCodeLine{01206             \textcolor{comment}{// 1. Draw background}}
\DoxyCodeLine{01207             var bgColor = node.Odd ? Colors.HeaderBackground : Colors.GreyBackground;}
\DoxyCodeLine{01208 }
\DoxyCodeLine{01209             \textcolor{keywordflow}{if} (SelectedNodes.Count > 0 \&\& SelectedNodes.Contains(node))}
\DoxyCodeLine{01210                 bgColor = Focused ? Colors.BlueSelection : Colors.GreySelection;}
\DoxyCodeLine{01211 }
\DoxyCodeLine{01212             \textcolor{keywordflow}{if} (IsDragging \&\& \_dropNode == node)}
\DoxyCodeLine{01213                 bgColor = Focused ? Colors.BlueSelection : Colors.GreySelection;}
\DoxyCodeLine{01214 }
\DoxyCodeLine{01215             \textcolor{keyword}{using} (var b = \textcolor{keyword}{new} SolidBrush(bgColor))}
\DoxyCodeLine{01216             \{}
\DoxyCodeLine{01217                 g.FillRectangle(b, rect);}
\DoxyCodeLine{01218             \}}
\DoxyCodeLine{01219 }
\DoxyCodeLine{01220             \textcolor{comment}{// 2. Draw plus/minus icon}}
\DoxyCodeLine{01221             \textcolor{keywordflow}{if} (node.Nodes.Count > 0)}
\DoxyCodeLine{01222             \{}
\DoxyCodeLine{01223                 var pos = \textcolor{keyword}{new} Point(node.ExpandArea.Location.X -\/ 1, node.ExpandArea.Location.Y -\/ 1);}
\DoxyCodeLine{01224 }
\DoxyCodeLine{01225                 var icon = \_nodeOpen;}
\DoxyCodeLine{01226 }
\DoxyCodeLine{01227                 \textcolor{keywordflow}{if} (node.Expanded \&\& !node.ExpandAreaHot)}
\DoxyCodeLine{01228                     icon = \_nodeOpen;}
\DoxyCodeLine{01229                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (node.Expanded \&\& node.ExpandAreaHot \&\& !SelectedNodes.Contains(node))}
\DoxyCodeLine{01230                     icon = \_nodeOpenHover;}
\DoxyCodeLine{01231                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (node.Expanded \&\& node.ExpandAreaHot \&\& SelectedNodes.Contains(node))}
\DoxyCodeLine{01232                     icon = \_nodeOpenHoverSelected;}
\DoxyCodeLine{01233                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!node.Expanded \&\& !node.ExpandAreaHot)}
\DoxyCodeLine{01234                     icon = \_nodeClosed;}
\DoxyCodeLine{01235                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!node.Expanded \&\& node.ExpandAreaHot \&\& !SelectedNodes.Contains(node))}
\DoxyCodeLine{01236                     icon = \_nodeClosedHover;}
\DoxyCodeLine{01237                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!node.Expanded \&\& node.ExpandAreaHot \&\& SelectedNodes.Contains(node))}
\DoxyCodeLine{01238                     icon = \_nodeClosedHoverSelected;}
\DoxyCodeLine{01239 }
\DoxyCodeLine{01240                 g.DrawImageUnscaled(icon, pos);}
\DoxyCodeLine{01241             \}}
\DoxyCodeLine{01242 }
\DoxyCodeLine{01243             \textcolor{comment}{// 3. Draw icon}}
\DoxyCodeLine{01244             \textcolor{keywordflow}{if} (ShowIcons \&\& node.Icon != \textcolor{keyword}{null})}
\DoxyCodeLine{01245             \{}
\DoxyCodeLine{01246                 \textcolor{keywordflow}{if} (node.Expanded \&\& node.ExpandedIcon != \textcolor{keyword}{null})}
\DoxyCodeLine{01247                     g.DrawImageUnscaled(node.ExpandedIcon, node.IconArea.Location);}
\DoxyCodeLine{01248                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{01249                     g.DrawImageUnscaled(node.Icon, node.IconArea.Location);}
\DoxyCodeLine{01250             \}}
\DoxyCodeLine{01251 }
\DoxyCodeLine{01252             \textcolor{comment}{// 4. Draw text}}
\DoxyCodeLine{01253             \textcolor{keyword}{using} (var b = \textcolor{keyword}{new} SolidBrush(Colors.LightText))}
\DoxyCodeLine{01254             \{}
\DoxyCodeLine{01255                 var stringFormat = \textcolor{keyword}{new} StringFormat}
\DoxyCodeLine{01256                 \{}
\DoxyCodeLine{01257                     Alignment = StringAlignment.Near,}
\DoxyCodeLine{01258                     LineAlignment = StringAlignment.Center}
\DoxyCodeLine{01259                 \};}
\DoxyCodeLine{01260 }
\DoxyCodeLine{01261                 g.DrawString(node.Text, Font, b, node.TextArea, stringFormat);}
\DoxyCodeLine{01262             \}}
\DoxyCodeLine{01263 }
\DoxyCodeLine{01264             \textcolor{comment}{// 5. Draw child nodes}}
\DoxyCodeLine{01265             \textcolor{keywordflow}{if} (node.Expanded)}
\DoxyCodeLine{01266             \{}
\DoxyCodeLine{01267                 \textcolor{keywordflow}{foreach} (var childNode \textcolor{keywordflow}{in} node.Nodes)}
\DoxyCodeLine{01268                     DrawNode(childNode, g);}
\DoxyCodeLine{01269             \}}
\DoxyCodeLine{01270         \}}
\DoxyCodeLine{01271 }
\DoxyCodeLine{01272 \textcolor{preprocessor}{        \#endregion Paint Region}}
\DoxyCodeLine{01273     \}}
\DoxyCodeLine{01274 \}}

\end{DoxyCode}
