\doxysection{Dock\+Resize\+Filter.\+cs}
\label{a00254_source}\index{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Win32/DockResizeFilter.cs@{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Win32/DockResizeFilter.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System.Drawing;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.Windows.Forms;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Docking;}
\DoxyCodeLine{00005 }
\DoxyCodeLine{00006 \textcolor{keyword}{namespace }VitNX.UI.BasedOnDarkUI.Win32}
\DoxyCodeLine{00007 \{}
\DoxyCodeLine{00008     \textcolor{keyword}{public} \textcolor{keyword}{class }DockResizeFilter : IMessageFilter}
\DoxyCodeLine{00009     \{}
\DoxyCodeLine{00010 \textcolor{preprocessor}{        \#region Field Region}}
\DoxyCodeLine{00011 }
\DoxyCodeLine{00012         \textcolor{keyword}{private} VitNX\_DockPanel \_dockPanel;}
\DoxyCodeLine{00013 }
\DoxyCodeLine{00014         \textcolor{keyword}{private} Timer \_dragTimer;}
\DoxyCodeLine{00015         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} \_isDragging;}
\DoxyCodeLine{00016         \textcolor{keyword}{private} Point \_initialContact;}
\DoxyCodeLine{00017         \textcolor{keyword}{private} VitNX\_DockSplitter \_activeSplitter;}
\DoxyCodeLine{00018 }
\DoxyCodeLine{00019 \textcolor{preprocessor}{        \#endregion Field Region}}
\DoxyCodeLine{00020 }
\DoxyCodeLine{00021 \textcolor{preprocessor}{        \#region Constructor Region}}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023         \textcolor{keyword}{public} DockResizeFilter(VitNX\_DockPanel dockPanel)}
\DoxyCodeLine{00024         \{}
\DoxyCodeLine{00025             \_dockPanel = dockPanel;}
\DoxyCodeLine{00026 }
\DoxyCodeLine{00027             \_dragTimer = \textcolor{keyword}{new} Timer();}
\DoxyCodeLine{00028             \_dragTimer.Interval = 1;}
\DoxyCodeLine{00029             \_dragTimer.Tick += DragTimer\_Tick;}
\DoxyCodeLine{00030         \}}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 \textcolor{preprocessor}{        \#endregion Constructor Region}}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 \textcolor{preprocessor}{        \#region IMessageFilter Region}}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} PreFilterMessage(ref Message m)}
\DoxyCodeLine{00037         \{}
\DoxyCodeLine{00038             \textcolor{comment}{// We only care about mouse events}}
\DoxyCodeLine{00039             \textcolor{keywordflow}{if} (!(m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.MOUSEMOVE ||}
\DoxyCodeLine{00040                   m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONDOWN || m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONUP || m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONDBLCLK ||}
\DoxyCodeLine{00041                   m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.RBUTTONDOWN || m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.RBUTTONUP || m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.RBUTTONDBLCLK))}
\DoxyCodeLine{00042                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044             \textcolor{comment}{// Stop drag.}}
\DoxyCodeLine{00045             \textcolor{keywordflow}{if} (m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONUP)}
\DoxyCodeLine{00046             \{}
\DoxyCodeLine{00047                 \textcolor{keywordflow}{if} (\_isDragging)}
\DoxyCodeLine{00048                 \{}
\DoxyCodeLine{00049                     StopDrag();}
\DoxyCodeLine{00050                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00051                 \}}
\DoxyCodeLine{00052             \}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054             \textcolor{comment}{// Exit out early if we're simply releasing a non-\/splitter drag over the area}}
\DoxyCodeLine{00055             \textcolor{keywordflow}{if} (m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONUP \&\& !\_isDragging)}
\DoxyCodeLine{00056                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00057 }
\DoxyCodeLine{00058             \textcolor{comment}{// Force cursor if already dragging.}}
\DoxyCodeLine{00059             \textcolor{keywordflow}{if} (\_isDragging)}
\DoxyCodeLine{00060                 Cursor.Current = \_activeSplitter.ResizeCursor;}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062             \textcolor{comment}{// Return out early if we're dragging something that's not a splitter.}}
\DoxyCodeLine{00063             \textcolor{keywordflow}{if} (m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.MOUSEMOVE \&\& !\_isDragging \&\& \_dockPanel.MouseButtonState != MouseButtons.None)}
\DoxyCodeLine{00064                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00065 }
\DoxyCodeLine{00066             \textcolor{comment}{// Try and create a control from the message handle.}}
\DoxyCodeLine{00067             var control = Control.FromHandle(m.HWnd);}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069             \textcolor{comment}{// Exit out if we didn't manage to create a control.}}
\DoxyCodeLine{00070             \textcolor{keywordflow}{if} (control == \textcolor{keyword}{null})}
\DoxyCodeLine{00071                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073             \textcolor{comment}{// Exit out if the control is not the dock panel or a child control.}}
\DoxyCodeLine{00074             \textcolor{keywordflow}{if} (!(control == \_dockPanel || \_dockPanel.Contains(control)))}
\DoxyCodeLine{00075                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077             \textcolor{comment}{// Update the mouse cursor}}
\DoxyCodeLine{00078             CheckCursor();}
\DoxyCodeLine{00079 }
\DoxyCodeLine{00080             \textcolor{comment}{// Start drag.}}
\DoxyCodeLine{00081             \textcolor{keywordflow}{if} (m.Msg == (\textcolor{keywordtype}{int})Functions.Windows.Win32.Enums.WINDOW\_MESSAGE.LBUTTONDOWN)}
\DoxyCodeLine{00082             \{}
\DoxyCodeLine{00083                 var hotSplitter = HotSplitter();}
\DoxyCodeLine{00084                 \textcolor{keywordflow}{if} (hotSplitter != \textcolor{keyword}{null})}
\DoxyCodeLine{00085                 \{}
\DoxyCodeLine{00086                     StartDrag(hotSplitter);}
\DoxyCodeLine{00087                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00088                 \}}
\DoxyCodeLine{00089             \}}
\DoxyCodeLine{00090 }
\DoxyCodeLine{00091             \textcolor{comment}{// Stop events passing through if we're hovering over a splitter}}
\DoxyCodeLine{00092             \textcolor{keywordflow}{if} (HotSplitter() != \textcolor{keyword}{null})}
\DoxyCodeLine{00093                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00094 }
\DoxyCodeLine{00095             \textcolor{comment}{// Stop all events from going through if we're dragging a splitter.}}
\DoxyCodeLine{00096             \textcolor{keywordflow}{if} (\_isDragging)}
\DoxyCodeLine{00097                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00100         \}}
\DoxyCodeLine{00101 }
\DoxyCodeLine{00102 \textcolor{preprocessor}{        \#endregion IMessageFilter Region}}
\DoxyCodeLine{00103 }
\DoxyCodeLine{00104 \textcolor{preprocessor}{        \#region Event Handler Region}}
\DoxyCodeLine{00105 }
\DoxyCodeLine{00106         \textcolor{keyword}{private} \textcolor{keywordtype}{void} DragTimer\_Tick(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00107         \{}
\DoxyCodeLine{00108             \textcolor{keywordflow}{if} (\_dockPanel.MouseButtonState != MouseButtons.Left)}
\DoxyCodeLine{00109             \{}
\DoxyCodeLine{00110                 StopDrag();}
\DoxyCodeLine{00111                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00112             \}}
\DoxyCodeLine{00113 }
\DoxyCodeLine{00114             var difference = \textcolor{keyword}{new} Point(\_initialContact.X -\/ Cursor.Position.X, \_initialContact.Y -\/ Cursor.Position.Y);}
\DoxyCodeLine{00115             \_activeSplitter.UpdateOverlay(difference);}
\DoxyCodeLine{00116         \}}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118 \textcolor{preprocessor}{        \#endregion Event Handler Region}}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120 \textcolor{preprocessor}{        \#region Method Region}}
\DoxyCodeLine{00121 }
\DoxyCodeLine{00122         \textcolor{keyword}{private} \textcolor{keywordtype}{void} StartDrag(VitNX\_DockSplitter splitter)}
\DoxyCodeLine{00123         \{}
\DoxyCodeLine{00124             \_activeSplitter = splitter;}
\DoxyCodeLine{00125             Cursor.Current = \_activeSplitter.ResizeCursor;}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127             \_initialContact = Cursor.Position;}
\DoxyCodeLine{00128             \_isDragging = \textcolor{keyword}{true};}
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130             \_activeSplitter.ShowOverlay();}
\DoxyCodeLine{00131             \_dragTimer.Start();}
\DoxyCodeLine{00132         \}}
\DoxyCodeLine{00133 }
\DoxyCodeLine{00134         \textcolor{keyword}{private} \textcolor{keywordtype}{void} StopDrag()}
\DoxyCodeLine{00135         \{}
\DoxyCodeLine{00136             \_dragTimer.Stop();}
\DoxyCodeLine{00137             \_activeSplitter.HideOverlay();}
\DoxyCodeLine{00138 }
\DoxyCodeLine{00139             var difference = \textcolor{keyword}{new} Point(\_initialContact.X -\/ Cursor.Position.X, \_initialContact.Y -\/ Cursor.Position.Y);}
\DoxyCodeLine{00140             \_activeSplitter.Move(difference);}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142             \_isDragging = \textcolor{keyword}{false};}
\DoxyCodeLine{00143         \}}
\DoxyCodeLine{00144 }
\DoxyCodeLine{00145         \textcolor{keyword}{private} VitNX\_DockSplitter HotSplitter()}
\DoxyCodeLine{00146         \{}
\DoxyCodeLine{00147             \textcolor{keywordflow}{foreach} (var splitter \textcolor{keywordflow}{in} \_dockPanel.Splitters)}
\DoxyCodeLine{00148             \{}
\DoxyCodeLine{00149                 \textcolor{keywordflow}{if} (splitter.Bounds.Contains(Cursor.Position))}
\DoxyCodeLine{00150                     \textcolor{keywordflow}{return} splitter;}
\DoxyCodeLine{00151             \}}
\DoxyCodeLine{00152 }
\DoxyCodeLine{00153             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00154         \}}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156         \textcolor{keyword}{private} \textcolor{keywordtype}{void} CheckCursor()}
\DoxyCodeLine{00157         \{}
\DoxyCodeLine{00158             \textcolor{keywordflow}{if} (\_isDragging)}
\DoxyCodeLine{00159                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161             var hotSplitter = HotSplitter();}
\DoxyCodeLine{00162             \textcolor{keywordflow}{if} (hotSplitter != \textcolor{keyword}{null})}
\DoxyCodeLine{00163                 Cursor.Current = hotSplitter.ResizeCursor;}
\DoxyCodeLine{00164         \}}
\DoxyCodeLine{00165 }
\DoxyCodeLine{00166         \textcolor{keyword}{private} \textcolor{keywordtype}{void} ResetCursor()}
\DoxyCodeLine{00167         \{}
\DoxyCodeLine{00168             Cursor.Current = Cursors.Default;}
\DoxyCodeLine{00169             CheckCursor();}
\DoxyCodeLine{00170         \}}
\DoxyCodeLine{00171 }
\DoxyCodeLine{00172 \textcolor{preprocessor}{        \#endregion Method Region}}
\DoxyCodeLine{00173     \}}
\DoxyCodeLine{00174 \}}

\end{DoxyCode}
