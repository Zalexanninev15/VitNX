\doxysection{Apps.\+cs}
\label{a00020_source}\index{E:/Github/VitNX/VitNX/Functions/Windows/Apps.cs@{E:/Github/VitNX/VitNX/Functions/Windows/Apps.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} Microsoft.Win32;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.Diagnostics;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} System.Management;}
\DoxyCodeLine{00005 \textcolor{keyword}{using} System.Reflection;}
\DoxyCodeLine{00006 \textcolor{keyword}{using} System.Security.Principal;}
\DoxyCodeLine{00007 }
\DoxyCodeLine{00008 \textcolor{keyword}{namespace }VitNX.Functions.Windows.Apps}
\DoxyCodeLine{00009 \{}
\DoxyCodeLine{00010     \textcolor{keyword}{public} \textcolor{keyword}{class }Processes}
\DoxyCodeLine{00011     \{}
\DoxyCodeLine{00012         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetList()}
\DoxyCodeLine{00013         \{}
\DoxyCodeLine{00014             \textcolor{keywordtype}{string} procList = \textcolor{stringliteral}{"{}Все процессы:"{}};}
\DoxyCodeLine{00015             \textcolor{keywordflow}{foreach} (Process process \textcolor{keywordflow}{in} Process.GetProcesses())}
\DoxyCodeLine{00016             \{}
\DoxyCodeLine{00017                 var procSize = \textcolor{stringliteral}{"{}0x0"{}};}
\DoxyCodeLine{00018                 \textcolor{keywordflow}{try}}
\DoxyCodeLine{00019                 \{}
\DoxyCodeLine{00020                     var counter = \textcolor{keyword}{new} PerformanceCounter(\textcolor{stringliteral}{"{}Process"{}}, \textcolor{stringliteral}{"{}Working Set -\/ Private"{}}, process.ProcessName);}
\DoxyCodeLine{00021                     procSize = Convert.ToString(counter.RawValue / 1048576);}
\DoxyCodeLine{00022                 \}}
\DoxyCodeLine{00023                 \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00024                 \textcolor{keywordflow}{if} (procSize != \textcolor{stringliteral}{"{}0x0"{}} \&\& procSize != \textcolor{stringliteral}{"{}0"{}})}
\DoxyCodeLine{00025                     procList += \$\textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nИмя поцесса: \{process.ProcessName\}.exe"{}} +}
\DoxyCodeLine{00026                         \$\textcolor{stringliteral}{"{}\(\backslash\)nID: \{process.Id\}"{}} +}
\DoxyCodeLine{00027                         \$\textcolor{stringliteral}{"{}\(\backslash\)nПамять: \{procSize\} МБ"{}} +}
\DoxyCodeLine{00028                         \$\textcolor{stringliteral}{"{}\(\backslash\)nTitle \& Handle: \(\backslash\)"{}\{process.MainWindowTitle\}\(\backslash\)"{} \& \{process.MainWindowHandle\}"{}};}
\DoxyCodeLine{00029             \}}
\DoxyCodeLine{00030             \textcolor{keywordflow}{return} procList;}
\DoxyCodeLine{00031         \}}
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Run(\textcolor{keywordtype}{string} targetFile,}
\DoxyCodeLine{00034             \textcolor{keywordtype}{string} arguments = \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00035         \{}
\DoxyCodeLine{00036             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00037             \{}
\DoxyCodeLine{00038                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00039                 \{}
\DoxyCodeLine{00040                     FileName = targetFile,}
\DoxyCodeLine{00041                     Arguments = arguments,}
\DoxyCodeLine{00042                     Verb = \textcolor{stringliteral}{"{}open"{}}}
\DoxyCodeLine{00043                 \}}
\DoxyCodeLine{00044             \};}
\DoxyCodeLine{00045             start.Start();}
\DoxyCodeLine{00046         \}}
\DoxyCodeLine{00047 }
\DoxyCodeLine{00048         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} Execute(\textcolor{keywordtype}{string} targetFile,}
\DoxyCodeLine{00049             \textcolor{keywordtype}{string} arguments)}
\DoxyCodeLine{00050         \{}
\DoxyCodeLine{00051             var codepage = System.Globalization.CultureInfo.CurrentCulture.TextInfo.OEMCodePage;}
\DoxyCodeLine{00052             var desiredEncoding = System.Text.Encoding.GetEncoding(codepage);}
\DoxyCodeLine{00053             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00054             \{}
\DoxyCodeLine{00055                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00056                 \{}
\DoxyCodeLine{00057                     FileName = targetFile,}
\DoxyCodeLine{00058                     Arguments = arguments,}
\DoxyCodeLine{00059                     CreateNoWindow = \textcolor{keyword}{true},}
\DoxyCodeLine{00060                     UseShellExecute = \textcolor{keyword}{false},}
\DoxyCodeLine{00061                     Verb = \textcolor{stringliteral}{"{}open"{}},}
\DoxyCodeLine{00062                     WindowStyle = ProcessWindowStyle.Hidden,}
\DoxyCodeLine{00063                     RedirectStandardOutput = \textcolor{keyword}{true},}
\DoxyCodeLine{00064                     StandardOutputEncoding = desiredEncoding}
\DoxyCodeLine{00065                 \}}
\DoxyCodeLine{00066             \};}
\DoxyCodeLine{00067             start.WaitForExit();}
\DoxyCodeLine{00068             start.Start();}
\DoxyCodeLine{00069             \textcolor{keywordtype}{string} output = start.StandardOutput.ReadToEnd();}
\DoxyCodeLine{00070             \textcolor{keywordflow}{return} output;}
\DoxyCodeLine{00071         \}}
\DoxyCodeLine{00072 }
\DoxyCodeLine{00073         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Open(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00074         \{}
\DoxyCodeLine{00075             var ps = \textcolor{keyword}{new} ProcessStartInfo(targetFile)}
\DoxyCodeLine{00076             \{}
\DoxyCodeLine{00077                 UseShellExecute = \textcolor{keyword}{true},}
\DoxyCodeLine{00078                 Verb = \textcolor{stringliteral}{"{}open"{}}}
\DoxyCodeLine{00079             \};}
\DoxyCodeLine{00080             Process.Start(ps);}
\DoxyCodeLine{00081         \}}
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083         \textcolor{keyword}{public} \textcolor{keyword}{static} Process OnlyOneProcess()}
\DoxyCodeLine{00084         \{}
\DoxyCodeLine{00085             Process current = Process.GetCurrentProcess();}
\DoxyCodeLine{00086             Process[] pr = Process.GetProcessesByName(current.ProcessName);}
\DoxyCodeLine{00087             \textcolor{keywordflow}{foreach} (Process i \textcolor{keywordflow}{in} pr)}
\DoxyCodeLine{00088             \{}
\DoxyCodeLine{00089                 \textcolor{keywordflow}{if} (i.Id != current.Id)}
\DoxyCodeLine{00090                 \{}
\DoxyCodeLine{00091                     \textcolor{keywordflow}{if} (Assembly.GetExecutingAssembly().Location.Replace(\textcolor{stringliteral}{"{}/"{}}, \textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)"{}}) == current.MainModule.FileName)}
\DoxyCodeLine{00092                     \{ \textcolor{keywordflow}{return} i; \}}
\DoxyCodeLine{00093                 \}}
\DoxyCodeLine{00094             \}}
\DoxyCodeLine{00095             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00096         \}}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00098         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} KillThis()}
\DoxyCodeLine{00099         \{}
\DoxyCodeLine{00100             Process.GetCurrentProcess().Kill();}
\DoxyCodeLine{00101         \}}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Kill(\textcolor{keywordtype}{string} processNameWithExe)}
\DoxyCodeLine{00104         \{}
\DoxyCodeLine{00105             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00106             \{}
\DoxyCodeLine{00107                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00108                 \{}
\DoxyCodeLine{00109                     FileName = \textcolor{stringliteral}{"{}taskkill"{}},}
\DoxyCodeLine{00110                     Arguments = \$\textcolor{stringliteral}{"{}/IM \(\backslash\)"{}\{processNameWithExe\}\(\backslash\)"{} /F /T"{}},}
\DoxyCodeLine{00111                     CreateNoWindow = \textcolor{keyword}{true},}
\DoxyCodeLine{00112                     WindowStyle = ProcessWindowStyle.Hidden,}
\DoxyCodeLine{00113                 \}}
\DoxyCodeLine{00114             \};}
\DoxyCodeLine{00115             start.Start();}
\DoxyCodeLine{00116         \}}
\DoxyCodeLine{00117 }
\DoxyCodeLine{00118         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} IsAdministrator\_YourApp()}
\DoxyCodeLine{00119         \{}
\DoxyCodeLine{00120             \textcolor{keywordflow}{return} \textcolor{keyword}{new} WindowsPrincipal(WindowsIdentity.GetCurrent()).IsInRole(WindowsBuiltInRole.Administrator);}
\DoxyCodeLine{00121         \}}
\DoxyCodeLine{00122     \}}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124     \textcolor{keyword}{public} \textcolor{keyword}{class }Installed}
\DoxyCodeLine{00125     \{}
\DoxyCodeLine{00126         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetList()}
\DoxyCodeLine{00127         \{}
\DoxyCodeLine{00128             \textcolor{keywordtype}{string} toText = \textcolor{stringliteral}{"{}Installed apps:"{}};}
\DoxyCodeLine{00129             ManagementObjectSearcher searcher = \textcolor{keyword}{new} ManagementObjectSearcher(\textcolor{stringliteral}{"{}SELECT * FROM Win32\_Product"{}});}
\DoxyCodeLine{00130             ManagementObjectCollection information = searcher.Get();}
\DoxyCodeLine{00131             \textcolor{keywordflow}{foreach} (ManagementObject app \textcolor{keywordflow}{in} information)}
\DoxyCodeLine{00132             \{}
\DoxyCodeLine{00133                 \textcolor{keywordtype}{string} toTextText = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00134                 \textcolor{keywordflow}{try}}
\DoxyCodeLine{00135                 \{}
\DoxyCodeLine{00136                     toTextText = GetPath(Convert.ToString(app[\textcolor{stringliteral}{"{}Name"{}}]));}
\DoxyCodeLine{00137                     \textcolor{keywordflow}{if} (toTextText == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00138                         toTextText = GetPath(Convert.ToString(app[\textcolor{stringliteral}{"{}IdentifyingNumber"{}}]));}
\DoxyCodeLine{00139                 \}}
\DoxyCodeLine{00140                 \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00141                 toText += (\$\textcolor{stringliteral}{"{}\(\backslash\)nName: \{app["{}}Name\textcolor{stringliteral}{"{}]\} (\{app["{}}Caption\textcolor{stringliteral}{"{}]\})"{}} +}
\DoxyCodeLine{00142                 \$\textcolor{stringliteral}{"{}\(\backslash\)nVersion: \{app["{}}Version\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00143                 \$\textcolor{stringliteral}{"{}\(\backslash\)nAuthor: \{app["{}}Vendor\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00144                 \$\textcolor{stringliteral}{"{}\(\backslash\)nInstall date: \{app["{}}InstallDate\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00145                 \$\textcolor{stringliteral}{"{}\(\backslash\)nInstall path: \{toTextText\}"{}});}
\DoxyCodeLine{00146             \}}
\DoxyCodeLine{00147             \textcolor{keywordflow}{return} toText;}
\DoxyCodeLine{00148         \}}
\DoxyCodeLine{00149 }
\DoxyCodeLine{00150         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetPath(\textcolor{keywordtype}{string} applicationName)}
\DoxyCodeLine{00151         \{}
\DoxyCodeLine{00152             var installPath = FindAppPath(\textcolor{stringliteral}{@"{}SOFTWARE\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00153             \textcolor{keywordflow}{if} (installPath == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00154                 installPath = FindAppPath(\textcolor{stringliteral}{@"{}SOFTWARE\(\backslash\)WOW6432Node\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00155             \textcolor{keywordflow}{if} (installPath == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00156                 installPath = FindAppPath(\textcolor{stringliteral}{@"{}HKEY\_CURRENT\_USER\(\backslash\)Software\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00157             \textcolor{keywordflow}{return} installPath;}
\DoxyCodeLine{00158         \}}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} FindAppPath(\textcolor{keywordtype}{string} keyPath, \textcolor{keywordtype}{string} applicationName)}
\DoxyCodeLine{00161         \{}
\DoxyCodeLine{00162             var uninstall = Registry.LocalMachine.OpenSubKey(keyPath);}
\DoxyCodeLine{00163             \textcolor{keywordflow}{foreach} (var productSubKey \textcolor{keywordflow}{in} uninstall.GetSubKeyNames())}
\DoxyCodeLine{00164             \{}
\DoxyCodeLine{00165                 var product = uninstall.OpenSubKey(productSubKey);}
\DoxyCodeLine{00166                 var displayName = product.GetValue(\textcolor{stringliteral}{"{}DisplayName"{}});}
\DoxyCodeLine{00167                 \textcolor{keywordflow}{if} (Convert.ToString(displayName) != \textcolor{stringliteral}{"{}"{}} \&\& Convert.ToString(displayName).Contains(applicationName))}
\DoxyCodeLine{00168                     \textcolor{keywordflow}{return} product.GetValue(\textcolor{stringliteral}{"{}InstallLocation"{}}).ToString();}
\DoxyCodeLine{00169             \}}
\DoxyCodeLine{00170             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00171         \}}
\DoxyCodeLine{00172     \}}
\DoxyCodeLine{00173 \}}

\end{DoxyCode}
