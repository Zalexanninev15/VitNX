\doxysection{Apps.\+cs}
\label{a00020_source}\index{E:/Github/VitNX/VitNX/Functions/Windows/Apps.cs@{E:/Github/VitNX/VitNX/Functions/Windows/Apps.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} Microsoft.Win32;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} System.Diagnostics;}
\DoxyCodeLine{00005 \textcolor{keyword}{using} System.Management;}
\DoxyCodeLine{00006 \textcolor{keyword}{using} System.Reflection;}
\DoxyCodeLine{00007 \textcolor{keyword}{using} System.Security.Principal;}
\DoxyCodeLine{00008 \textcolor{keyword}{using} System.Threading;}
\DoxyCodeLine{00009 }
\DoxyCodeLine{00010 \textcolor{keyword}{namespace }VitNX.Functions.Windows.Apps}
\DoxyCodeLine{00011 \{}
\DoxyCodeLine{00012     \textcolor{keyword}{public} \textcolor{keyword}{class }Processes}
\DoxyCodeLine{00013     \{}
\DoxyCodeLine{00014         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetListWithInformation()}
\DoxyCodeLine{00015         \{}
\DoxyCodeLine{00016             \textcolor{keywordtype}{string} procList = \textcolor{stringliteral}{"{}All processes:"{}};}
\DoxyCodeLine{00017             \textcolor{keywordflow}{foreach} (Process process \textcolor{keywordflow}{in} Process.GetProcesses())}
\DoxyCodeLine{00018             \{}
\DoxyCodeLine{00019                 var procSize = \textcolor{stringliteral}{"{}0x0"{}};}
\DoxyCodeLine{00020                 \textcolor{keywordflow}{try}}
\DoxyCodeLine{00021                 \{}
\DoxyCodeLine{00022                     var counter = \textcolor{keyword}{new} PerformanceCounter(\textcolor{stringliteral}{"{}Process"{}}, \textcolor{stringliteral}{"{}Working Set -\/ Private"{}}, process.ProcessName);}
\DoxyCodeLine{00023                     procSize = Convert.ToString(counter.RawValue / 1048576);}
\DoxyCodeLine{00024                 \}}
\DoxyCodeLine{00025                 \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00026                 \textcolor{keywordflow}{if} (procSize != \textcolor{stringliteral}{"{}0x0"{}} \&\& procSize != \textcolor{stringliteral}{"{}0"{}})}
\DoxyCodeLine{00027                     procList += \$\textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nName: \{process.ProcessName\}.exe"{}} +}
\DoxyCodeLine{00028                         \$\textcolor{stringliteral}{"{}\(\backslash\)nID: \{process.Id\}"{}} +}
\DoxyCodeLine{00029                         \$\textcolor{stringliteral}{"{}\(\backslash\)nUsed memory: \{procSize\} МБ"{}} +}
\DoxyCodeLine{00030                         \$\textcolor{stringliteral}{"{}\(\backslash\)nTitle \& Handle: \(\backslash\)"{}\{process.MainWindowTitle\}\(\backslash\)"{} \& \{process.MainWindowHandle\}"{}};}
\DoxyCodeLine{00031             \}}
\DoxyCodeLine{00032             \textcolor{keywordflow}{return} procList;}
\DoxyCodeLine{00033         \}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035         \textcolor{keyword}{public} \textcolor{keyword}{static} List<string> GetList()}
\DoxyCodeLine{00036         \{}
\DoxyCodeLine{00037             List<string> output = \textcolor{keyword}{new} List<string>();}
\DoxyCodeLine{00038             \textcolor{keywordflow}{foreach} (Process proc \textcolor{keywordflow}{in} Process.GetProcesses())}
\DoxyCodeLine{00039                 output.Add(proc.ProcessName.ToUpper());}
\DoxyCodeLine{00040             \textcolor{keywordflow}{return} output;}
\DoxyCodeLine{00041         \}}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Run(\textcolor{keywordtype}{string} targetFile,}
\DoxyCodeLine{00044             \textcolor{keywordtype}{string} arguments = \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00045         \{}
\DoxyCodeLine{00046             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00047             \{}
\DoxyCodeLine{00048                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00049                 \{}
\DoxyCodeLine{00050                     FileName = targetFile,}
\DoxyCodeLine{00051                     Arguments = arguments,}
\DoxyCodeLine{00052                     \textcolor{comment}{//Verb = "{}open"{}}}
\DoxyCodeLine{00053                 \}}
\DoxyCodeLine{00054             \};}
\DoxyCodeLine{00055             start.Start();}
\DoxyCodeLine{00056         \}}
\DoxyCodeLine{00057 }
\DoxyCodeLine{00058         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} Execute(\textcolor{keywordtype}{string} targetFile,}
\DoxyCodeLine{00059             \textcolor{keywordtype}{string} arguments)}
\DoxyCodeLine{00060         \{}
\DoxyCodeLine{00061             var codepage = System.Globalization.CultureInfo.CurrentCulture.TextInfo.OEMCodePage;}
\DoxyCodeLine{00062             var desiredEncoding = System.Text.Encoding.GetEncoding(codepage);}
\DoxyCodeLine{00063             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00064             \{}
\DoxyCodeLine{00065                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00066                 \{}
\DoxyCodeLine{00067                     FileName = targetFile,}
\DoxyCodeLine{00068                     Arguments = arguments,}
\DoxyCodeLine{00069                     CreateNoWindow = \textcolor{keyword}{true},}
\DoxyCodeLine{00070                     UseShellExecute = \textcolor{keyword}{false},}
\DoxyCodeLine{00071                     \textcolor{comment}{//Verb = "{}open"{},}}
\DoxyCodeLine{00072                     WindowStyle = ProcessWindowStyle.Hidden,}
\DoxyCodeLine{00073                     RedirectStandardOutput = \textcolor{keyword}{true},}
\DoxyCodeLine{00074                     StandardOutputEncoding = desiredEncoding}
\DoxyCodeLine{00075                 \}}
\DoxyCodeLine{00076             \};}
\DoxyCodeLine{00077             start.WaitForExit();}
\DoxyCodeLine{00078             start.Start();}
\DoxyCodeLine{00079             \textcolor{keywordtype}{string} output = start.StandardOutput.ReadToEnd();}
\DoxyCodeLine{00080             \textcolor{keywordflow}{return} output;}
\DoxyCodeLine{00081         \}}
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Open(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00084         \{}
\DoxyCodeLine{00085             var ps = \textcolor{keyword}{new} ProcessStartInfo(targetFile)}
\DoxyCodeLine{00086             \{}
\DoxyCodeLine{00087                 UseShellExecute = \textcolor{keyword}{true},}
\DoxyCodeLine{00088                 Verb = \textcolor{stringliteral}{"{}open"{}}}
\DoxyCodeLine{00089             \};}
\DoxyCodeLine{00090             Process.Start(ps);}
\DoxyCodeLine{00091         \}}
\DoxyCodeLine{00092 }
\DoxyCodeLine{00093         \textcolor{keyword}{public} \textcolor{keyword}{static} Process OnlyOneProcess()}
\DoxyCodeLine{00094         \{}
\DoxyCodeLine{00095             Process current = Process.GetCurrentProcess();}
\DoxyCodeLine{00096             Process[] pr = Process.GetProcessesByName(current.ProcessName);}
\DoxyCodeLine{00097             \textcolor{keywordflow}{foreach} (Process i \textcolor{keywordflow}{in} pr)}
\DoxyCodeLine{00098             \{}
\DoxyCodeLine{00099                 \textcolor{keywordflow}{if} (i.Id != current.Id)}
\DoxyCodeLine{00100                 \{}
\DoxyCodeLine{00101                     \textcolor{keywordflow}{if} (Assembly.GetExecutingAssembly().Location.Replace(\textcolor{stringliteral}{"{}/"{}}, \textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)"{}}) == current.MainModule.FileName)}
\DoxyCodeLine{00102                     \{ \textcolor{keywordflow}{return} i; \}}
\DoxyCodeLine{00103                 \}}
\DoxyCodeLine{00104             \}}
\DoxyCodeLine{00105             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00106         \}}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} KillThis()}
\DoxyCodeLine{00109         \{}
\DoxyCodeLine{00110             Process.GetCurrentProcess().Kill();}
\DoxyCodeLine{00111         \}}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} Kill(\textcolor{keywordtype}{string} processNameWithExe)}
\DoxyCodeLine{00114         \{}
\DoxyCodeLine{00115             var start = \textcolor{keyword}{new} Process}
\DoxyCodeLine{00116             \{}
\DoxyCodeLine{00117                 StartInfo = \textcolor{keyword}{new} ProcessStartInfo}
\DoxyCodeLine{00118                 \{}
\DoxyCodeLine{00119                     FileName = \textcolor{stringliteral}{"{}taskkill"{}},}
\DoxyCodeLine{00120                     Arguments = \$\textcolor{stringliteral}{"{}/IM \(\backslash\)"{}\{processNameWithExe\}\(\backslash\)"{} /F /T"{}},}
\DoxyCodeLine{00121                     CreateNoWindow = \textcolor{keyword}{true},}
\DoxyCodeLine{00122                     WindowStyle = ProcessWindowStyle.Hidden,}
\DoxyCodeLine{00123                 \}}
\DoxyCodeLine{00124             \};}
\DoxyCodeLine{00125             start.Start();}
\DoxyCodeLine{00126         \}}
\DoxyCodeLine{00127 }
\DoxyCodeLine{00128         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} IsAdministratorYourApp()}
\DoxyCodeLine{00129         \{}
\DoxyCodeLine{00130             \textcolor{keywordflow}{return} \textcolor{keyword}{new} WindowsPrincipal(WindowsIdentity.GetCurrent()).IsInRole(WindowsBuiltInRole.Administrator);}
\DoxyCodeLine{00131         \}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} IsOneYourApp(\textcolor{keywordtype}{string} appTitle)}
\DoxyCodeLine{00134         \{}
\DoxyCodeLine{00135             \textcolor{keywordtype}{bool} createdNew = \textcolor{keyword}{false};}
\DoxyCodeLine{00136             Mutex currentApp = \textcolor{keyword}{new} Mutex(\textcolor{keyword}{false}, appTitle, out createdNew);}
\DoxyCodeLine{00137             \textcolor{keywordflow}{if} (!createdNew)}
\DoxyCodeLine{00138                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00139             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00140                 \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00141         \}}
\DoxyCodeLine{00142     \}}
\DoxyCodeLine{00143 }
\DoxyCodeLine{00144     \textcolor{keyword}{public} \textcolor{keyword}{class }Installed}
\DoxyCodeLine{00145     \{}
\DoxyCodeLine{00146         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetList()}
\DoxyCodeLine{00147         \{}
\DoxyCodeLine{00148             \textcolor{keywordtype}{string} toText = \textcolor{stringliteral}{"{}Installed apps:"{}};}
\DoxyCodeLine{00149             ManagementObjectSearcher searcher = \textcolor{keyword}{new} ManagementObjectSearcher(\textcolor{stringliteral}{"{}SELECT * FROM Win32\_Product"{}});}
\DoxyCodeLine{00150             ManagementObjectCollection information = searcher.Get();}
\DoxyCodeLine{00151             \textcolor{keywordflow}{foreach} (ManagementObject app \textcolor{keywordflow}{in} information)}
\DoxyCodeLine{00152             \{}
\DoxyCodeLine{00153                 \textcolor{keywordtype}{string} toTextText = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00154                 \textcolor{keywordflow}{try}}
\DoxyCodeLine{00155                 \{}
\DoxyCodeLine{00156                     toTextText = GetPath(Convert.ToString(app[\textcolor{stringliteral}{"{}Name"{}}]));}
\DoxyCodeLine{00157                     \textcolor{keywordflow}{if} (toTextText == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00158                         toTextText = GetPath(Convert.ToString(app[\textcolor{stringliteral}{"{}IdentifyingNumber"{}}]));}
\DoxyCodeLine{00159                 \}}
\DoxyCodeLine{00160                 \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00161                 toText += (\$\textcolor{stringliteral}{"{}\(\backslash\)nName: \{app["{}}Name\textcolor{stringliteral}{"{}]\} (\{app["{}}Caption\textcolor{stringliteral}{"{}]\})"{}} +}
\DoxyCodeLine{00162                 \$\textcolor{stringliteral}{"{}\(\backslash\)nVersion: \{app["{}}Version\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00163                 \$\textcolor{stringliteral}{"{}\(\backslash\)nAuthor: \{app["{}}Vendor\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00164                 \$\textcolor{stringliteral}{"{}\(\backslash\)nInstall date: \{app["{}}InstallDate\textcolor{stringliteral}{"{}]\}"{}} +}
\DoxyCodeLine{00165                 \$\textcolor{stringliteral}{"{}\(\backslash\)nInstall path: \{toTextText\}"{}});}
\DoxyCodeLine{00166             \}}
\DoxyCodeLine{00167             \textcolor{keywordflow}{return} toText;}
\DoxyCodeLine{00168         \}}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00170         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetPath(\textcolor{keywordtype}{string} applicationName)}
\DoxyCodeLine{00171         \{}
\DoxyCodeLine{00172             var installPath = FindAppPath(\textcolor{stringliteral}{@"{}SOFTWARE\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00173             \textcolor{keywordflow}{if} (installPath == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00174                 installPath = FindAppPath(\textcolor{stringliteral}{@"{}SOFTWARE\(\backslash\)WOW6432Node\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00175             \textcolor{keywordflow}{if} (installPath == \textcolor{stringliteral}{"{}"{}})}
\DoxyCodeLine{00176                 installPath = FindAppPath(\textcolor{stringliteral}{@"{}HKEY\_CURRENT\_USER\(\backslash\)Software\(\backslash\)Microsoft\(\backslash\)Windows\(\backslash\)CurrentVersion\(\backslash\)Uninstall"{}}, applicationName);}
\DoxyCodeLine{00177             \textcolor{keywordflow}{return} installPath;}
\DoxyCodeLine{00178         \}}
\DoxyCodeLine{00179 }
\DoxyCodeLine{00180         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} FindAppPath(\textcolor{keywordtype}{string} keyPath, \textcolor{keywordtype}{string} applicationName)}
\DoxyCodeLine{00181         \{}
\DoxyCodeLine{00182             var uninstall = Registry.LocalMachine.OpenSubKey(keyPath);}
\DoxyCodeLine{00183             \textcolor{keywordflow}{foreach} (var productSubKey \textcolor{keywordflow}{in} uninstall.GetSubKeyNames())}
\DoxyCodeLine{00184             \{}
\DoxyCodeLine{00185                 var product = uninstall.OpenSubKey(productSubKey);}
\DoxyCodeLine{00186                 var displayName = product.GetValue(\textcolor{stringliteral}{"{}DisplayName"{}});}
\DoxyCodeLine{00187                 \textcolor{keywordflow}{if} (Convert.ToString(displayName) != \textcolor{stringliteral}{"{}"{}} \&\& Convert.ToString(displayName).Contains(applicationName))}
\DoxyCodeLine{00188                     \textcolor{keywordflow}{return} product.GetValue(\textcolor{stringliteral}{"{}InstallLocation"{}}).ToString();}
\DoxyCodeLine{00189             \}}
\DoxyCodeLine{00190             \textcolor{keywordflow}{return} \textcolor{keyword}{null};}
\DoxyCodeLine{00191         \}}
\DoxyCodeLine{00192     \}}
\DoxyCodeLine{00193 \}}

\end{DoxyCode}
