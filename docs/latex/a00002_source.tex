\doxysection{File\+System.\+cs}
\label{a00002_source}\index{E:/Github/VitNX/VitNX/Functions/Common/FileSystem.cs@{E:/Github/VitNX/VitNX/Functions/Common/FileSystem.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.IO;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} System.Text;}
\DoxyCodeLine{00005 }
\DoxyCodeLine{00006 \textcolor{keyword}{namespace }VitNX.Functions.Common}
\DoxyCodeLine{00007 \{}
\DoxyCodeLine{00008     \textcolor{keyword}{public} \textcolor{keyword}{class }FileSystem}
\DoxyCodeLine{00009     \{}
\DoxyCodeLine{00010         \textcolor{keyword}{public} \textcolor{keyword}{static} List<string> ReturnRecursFList(\textcolor{keywordtype}{string} sourceFolder)}
\DoxyCodeLine{00011         \{}
\DoxyCodeLine{00012             List<string> ls = \textcolor{keyword}{new} List<string>();}
\DoxyCodeLine{00013             \textcolor{keywordflow}{try}}
\DoxyCodeLine{00014             \{}
\DoxyCodeLine{00015                 \textcolor{keywordtype}{string}[] folders = Directory.GetDirectories(sourceFolder);}
\DoxyCodeLine{00016                 \textcolor{keywordflow}{foreach} (\textcolor{keywordtype}{string} folder \textcolor{keywordflow}{in} folders) ls.Add(\textcolor{stringliteral}{"{}Folder: "{}} + folder);}
\DoxyCodeLine{00017                 \textcolor{keywordtype}{string}[] files = Directory.GetFiles(sourceFolder);}
\DoxyCodeLine{00018                 \textcolor{keywordflow}{foreach} (\textcolor{keywordtype}{string} filename \textcolor{keywordflow}{in} files) ls.Add(\textcolor{stringliteral}{"{}File: "{}} + filename);}
\DoxyCodeLine{00019             \}}
\DoxyCodeLine{00020             \textcolor{keywordflow}{catch} (Exception e) \{ ls.Add(e.Message.Trim(\textcolor{charliteral}{'\(\backslash\)n'})); \}}
\DoxyCodeLine{00021             \textcolor{keywordflow}{return} ls;}
\DoxyCodeLine{00022         \}}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{long} GetDirectorySize(DirectoryInfo sourceFolder)}
\DoxyCodeLine{00025         \{}
\DoxyCodeLine{00026             \textcolor{keywordtype}{long} size = 0;}
\DoxyCodeLine{00027             FileInfo[] fis = sourceFolder.GetFiles();}
\DoxyCodeLine{00028             \textcolor{keywordflow}{foreach} (FileInfo fi \textcolor{keywordflow}{in} fis)}
\DoxyCodeLine{00029                 size += fi.Length;}
\DoxyCodeLine{00030             DirectoryInfo[] dis = sourceFolder.GetDirectories();}
\DoxyCodeLine{00031             \textcolor{keywordflow}{foreach} (DirectoryInfo di \textcolor{keywordflow}{in} dis)}
\DoxyCodeLine{00032                 size += GetDirectorySize(di);}
\DoxyCodeLine{00033             \textcolor{keywordflow}{return} size;}
\DoxyCodeLine{00034         \}}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} DeleteFile(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00037         \{}
\DoxyCodeLine{00038             \textcolor{keywordflow}{try} \{ File.Delete(targetFile); \} \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00039         \}}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} DeleteFileInTrash(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00042         \{}
\DoxyCodeLine{00043             \textcolor{keywordflow}{try} \{ File.SetAttributes(targetFile, FileAttributes.Normal); \} \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00044             Microsoft.VisualBasic.FileIO.FileSystem.DeleteFile(targetFile,}
\DoxyCodeLine{00045                 Microsoft.VisualBasic.FileIO.UIOption.OnlyErrorDialogs,}
\DoxyCodeLine{00046                 Microsoft.VisualBasic.FileIO.RecycleOption.SendToRecycleBin);}
\DoxyCodeLine{00047         \}}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} DeleteDirectoryToTrash(\textcolor{keywordtype}{string} targetFolder)}
\DoxyCodeLine{00050         \{}
\DoxyCodeLine{00051             Microsoft.VisualBasic.FileIO.FileSystem.DeleteDirectory(targetFolder,}
\DoxyCodeLine{00052                 Microsoft.VisualBasic.FileIO.UIOption.OnlyErrorDialogs,}
\DoxyCodeLine{00053                 Microsoft.VisualBasic.FileIO.RecycleOption.SendToRecycleBin);}
\DoxyCodeLine{00054         \}}
\DoxyCodeLine{00055 }
\DoxyCodeLine{00056         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string}[] WriteTextToFileUTF8(\textcolor{keywordtype}{string} text, \textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00057         \{}
\DoxyCodeLine{00058             \textcolor{keywordtype}{string} fileName = FileNameGenerator(targetFile, \textcolor{stringliteral}{"{}txt"{}});}
\DoxyCodeLine{00059             \textcolor{keywordtype}{string} filePath = \$\textcolor{stringliteral}{@"{}\{Path.GetTempPath()\}\(\backslash\)\{fileName\}"{}};}
\DoxyCodeLine{00060             \textcolor{keyword}{using} (FileStream fs = File.OpenWrite(filePath))}
\DoxyCodeLine{00061             \{}
\DoxyCodeLine{00062                 var data = text;}
\DoxyCodeLine{00063                 \textcolor{keywordtype}{byte}[] bytes = System.Text.Encoding.UTF8.GetBytes(data);}
\DoxyCodeLine{00064                 fs.Write(bytes, 0, bytes.Length);}
\DoxyCodeLine{00065             \}}
\DoxyCodeLine{00066             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \textcolor{keywordtype}{string}[] \{ fileName, filePath \};}
\DoxyCodeLine{00067         \}}
\DoxyCodeLine{00068 }
\DoxyCodeLine{00069         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetText(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00070         \{}
\DoxyCodeLine{00071             \textcolor{keywordtype}{string} text = \textcolor{stringliteral}{"{}Text file not found"{}};}
\DoxyCodeLine{00072             \textcolor{keyword}{using} (StreamReader sr = File.OpenText(targetFile))}
\DoxyCodeLine{00073                 text = sr.ReadToEnd();}
\DoxyCodeLine{00074             \textcolor{keywordflow}{return} text;}
\DoxyCodeLine{00075         \}}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} GetMD5(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00078         \{}
\DoxyCodeLine{00079             \textcolor{keyword}{using} (var md5 = System.Security.Cryptography.MD5.Create())}
\DoxyCodeLine{00080             \{}
\DoxyCodeLine{00081                 \textcolor{keyword}{using} (var Stream = File.OpenRead(targetFile))}
\DoxyCodeLine{00082                 \{}
\DoxyCodeLine{00083                     var hashBytes = md5.ComputeHash(Stream);}
\DoxyCodeLine{00084                     var sb = \textcolor{keyword}{new} StringBuilder();}
\DoxyCodeLine{00085                     \textcolor{keywordflow}{foreach} (var t \textcolor{keywordflow}{in} hashBytes)}
\DoxyCodeLine{00086                         sb.Append(t.ToString(\textcolor{stringliteral}{"{}X2"{}}));}
\DoxyCodeLine{00087                     \textcolor{keywordflow}{return} Convert.ToString(sb);}
\DoxyCodeLine{00088                 \}}
\DoxyCodeLine{00089             \}}
\DoxyCodeLine{00090         \}}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{string} FileNameGenerator(\textcolor{keywordtype}{string} tag, \textcolor{keywordtype}{string} fileExtension)}
\DoxyCodeLine{00093         \{}
\DoxyCodeLine{00094             \textcolor{keywordtype}{string} fileName = \textcolor{keywordtype}{string}.Format(\textcolor{stringliteral}{"{}\{0\}\_\{1\}\_\{2\}.\{3\}"{}},}
\DoxyCodeLine{00095                 tag,}
\DoxyCodeLine{00096                 DateTime.Now.ToString(\textcolor{stringliteral}{"{}yyyyMMddHHmmssfff"{}}),}
\DoxyCodeLine{00097                 Guid.NewGuid(),}
\DoxyCodeLine{00098                 fileExtension);}
\DoxyCodeLine{00099             \textcolor{keywordflow}{return} fileName;}
\DoxyCodeLine{00100         \}}
\DoxyCodeLine{00101 }
\DoxyCodeLine{00102         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} CleanRecycleBin()}
\DoxyCodeLine{00103         \{}
\DoxyCodeLine{00104             Windows.Win32.Import.SHEmptyRecycleBin(IntPtr.Zero, \textcolor{keyword}{null},}
\DoxyCodeLine{00105 Windows.Win32.Enums.SHERB\_RECYCLE.SHERB\_NOSOUND |}
\DoxyCodeLine{00106 Windows.Win32.Enums.SHERB\_RECYCLE.SHERB\_NOCONFIRMATION);}
\DoxyCodeLine{00107         \}}
\DoxyCodeLine{00108 }
\DoxyCodeLine{00109         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} CreateFileBackup(\textcolor{keywordtype}{string} sourceFolder, \textcolor{keywordtype}{string} newFileExtension, \textcolor{keywordtype}{bool} saveOldFile)}
\DoxyCodeLine{00110         \{}
\DoxyCodeLine{00111             \textcolor{keywordtype}{string} bak\_file = sourceFolder + \textcolor{stringliteral}{"{}."{}} + newFileExtension.Replace(\textcolor{stringliteral}{"{}."{}}, \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00112             \textcolor{keywordflow}{if} (File.Exists(bak\_file)) \{ \textcolor{keywordflow}{try} \{ File.Delete(bak\_file); \} \textcolor{keywordflow}{catch} \{ \} \}}
\DoxyCodeLine{00113             \textcolor{keywordflow}{if} (saveOldFile == \textcolor{keyword}{false}) \{ \textcolor{keywordflow}{try} \{ File.Move(sourceFolder, bak\_file); \} \textcolor{keywordflow}{catch} \{ \} \}}
\DoxyCodeLine{00114             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00115             \{}
\DoxyCodeLine{00116                 File.Copy(sourceFolder, bak\_file);}
\DoxyCodeLine{00117                 \textcolor{keywordflow}{try} \{ File.Delete(sourceFolder); \} \textcolor{keywordflow}{catch} \{ \}}
\DoxyCodeLine{00118             \}}
\DoxyCodeLine{00119         \}}
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} CreateShortcut(\textcolor{keywordtype}{string} shortcut, \textcolor{keywordtype}{string} targetFile, \textcolor{keywordtype}{string} nameExe)}
\DoxyCodeLine{00122         \{}
\DoxyCodeLine{00123             IWshRuntimeLibrary.WshShell wshShell = \textcolor{keyword}{new} IWshRuntimeLibrary.WshShell();}
\DoxyCodeLine{00124             IWshRuntimeLibrary.IWshShortcut Shortcut = (IWshRuntimeLibrary.IWshShortcut)wshShell.CreateShortcut(shortcut);}
\DoxyCodeLine{00125             Shortcut.TargetPath = targetFile;}
\DoxyCodeLine{00126             Shortcut.WorkingDirectory = targetFile.Replace(\textcolor{stringliteral}{@"{}\(\backslash\)"{}} + nameExe, \textcolor{stringliteral}{"{}"{}}).Replace(\textcolor{stringliteral}{"{}.exe"{}}, \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00127             Shortcut.Save();}
\DoxyCodeLine{00128         \}}
\DoxyCodeLine{00129 }
\DoxyCodeLine{00130         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} CopyFolder(\textcolor{keywordtype}{string} sourceFolder, \textcolor{keywordtype}{string} targetFolder)}
\DoxyCodeLine{00131         \{ }
\DoxyCodeLine{00132             Microsoft.VisualBasic.FileIO.FileSystem.CopyDirectory(sourceFolder, targetFolder); }
\DoxyCodeLine{00133         \}}
\DoxyCodeLine{00134 }
\DoxyCodeLine{00135         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} IsPeExe(\textcolor{keywordtype}{string} targetFile)}
\DoxyCodeLine{00136         \{}
\DoxyCodeLine{00137             var twoBytes = \textcolor{keyword}{new} \textcolor{keywordtype}{byte}[2];}
\DoxyCodeLine{00138             \textcolor{keyword}{using} (var fileStream = File.Open(targetFile, FileMode.Open))}
\DoxyCodeLine{00139                 fileStream.Read(twoBytes, 0, 2);}
\DoxyCodeLine{00140             \textcolor{keywordflow}{return} Encoding.UTF8.GetString(twoBytes) == \textcolor{stringliteral}{"{}MZ"{}};}
\DoxyCodeLine{00141         \}}
\DoxyCodeLine{00142 }
\DoxyCodeLine{00143         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} ZipFolder(\textcolor{keywordtype}{string} sourceFolder, \textcolor{keywordtype}{string} zipFile)}
\DoxyCodeLine{00144         \{}
\DoxyCodeLine{00145             \textcolor{keywordflow}{if} (!Directory.Exists(sourceFolder))}
\DoxyCodeLine{00146                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} ArgumentException(\textcolor{stringliteral}{"{}sourceDirectory"{}});}
\DoxyCodeLine{00147             \textcolor{keywordtype}{byte}[] zipHeader = \textcolor{keyword}{new} \textcolor{keywordtype}{byte}[] \{ 80, 75, 5, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 \};}
\DoxyCodeLine{00148             \textcolor{keyword}{using} (FileStream fs = File.Create(zipFile))}
\DoxyCodeLine{00149                 fs.Write(zipHeader, 0, zipHeader.Length);}
\DoxyCodeLine{00150             dynamic shellApplication = Activator.CreateInstance(Type.GetTypeFromProgID(\textcolor{stringliteral}{"{}Shell.Application"{}}));}
\DoxyCodeLine{00151             dynamic source = shellApplication.NameSpace(sourceFolder);}
\DoxyCodeLine{00152             dynamic destination = shellApplication.NameSpace(zipFile);}
\DoxyCodeLine{00153             destination.CopyHere(source.Items(), 20);}
\DoxyCodeLine{00154         \}}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} UnzipFile(\textcolor{keywordtype}{string} zipFile, \textcolor{keywordtype}{string} targetFolder)}
\DoxyCodeLine{00157         \{}
\DoxyCodeLine{00158             \textcolor{keywordflow}{if} (!Directory.Exists(targetFolder))}
\DoxyCodeLine{00159                 Directory.CreateDirectory(targetFolder);}
\DoxyCodeLine{00160             dynamic shellApplication = Activator.CreateInstance(Type.GetTypeFromProgID(\textcolor{stringliteral}{"{}Shell.Application"{}}));}
\DoxyCodeLine{00161             dynamic compressedFolderContents = shellApplication.NameSpace(zipFile).Items;}
\DoxyCodeLine{00162             dynamic destinationFolder = shellApplication.NameSpace(targetFolder);}
\DoxyCodeLine{00163             destinationFolder.CopyHere(compressedFolderContents);}
\DoxyCodeLine{00164         \}}
\DoxyCodeLine{00165     \}}
\DoxyCodeLine{00166 \}}

\end{DoxyCode}
