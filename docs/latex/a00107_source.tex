\doxysection{Vit\+NX\+\_\+\+List\+View.\+cs}
\label{a00107_source}\index{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Controls/VitNX\_ListView.cs@{E:/Github/VitNX/VitNX/UI/BasedOnDarkUI/Controls/VitNX\_ListView.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{00002 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{00003 \textcolor{keyword}{using} System.Collections.ObjectModel;}
\DoxyCodeLine{00004 \textcolor{keyword}{using} System.Collections.Specialized;}
\DoxyCodeLine{00005 \textcolor{keyword}{using} System.ComponentModel;}
\DoxyCodeLine{00006 \textcolor{keyword}{using} System.Drawing;}
\DoxyCodeLine{00007 \textcolor{keyword}{using} System.Linq;}
\DoxyCodeLine{00008 \textcolor{keyword}{using} System.Windows.Forms;}
\DoxyCodeLine{00009 \textcolor{keyword}{using} VitNX.UI.BasedOnDarkUI.Config;}
\DoxyCodeLine{00010 }
\DoxyCodeLine{00011 \textcolor{keyword}{namespace }VitNX.UI.BasedOnDarkUI.Controls}
\DoxyCodeLine{00012 \{}
\DoxyCodeLine{00013     \textcolor{keyword}{public} \textcolor{keyword}{class }VitNX\_ListView : VitNX\_ScrollView}
\DoxyCodeLine{00014     \{}
\DoxyCodeLine{00015 \textcolor{preprocessor}{        \#region Event Region}}
\DoxyCodeLine{00016 }
\DoxyCodeLine{00017         \textcolor{keyword}{public} \textcolor{keyword}{event} EventHandler SelectedIndicesChanged;}
\DoxyCodeLine{00018 }
\DoxyCodeLine{00019 \textcolor{preprocessor}{        \#endregion Event Region}}
\DoxyCodeLine{00020 }
\DoxyCodeLine{00021 \textcolor{preprocessor}{        \#region Field Region}}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_itemHeight = 20;}
\DoxyCodeLine{00024         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} \_multiSelect;}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026         \textcolor{keyword}{private} readonly \textcolor{keywordtype}{int} \_iconSize = 16;}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028         \textcolor{keyword}{private} ObservableCollection<VitNX\_ListItem> \_items;}
\DoxyCodeLine{00029         \textcolor{keyword}{private} List<int> \_selectedIndices;}
\DoxyCodeLine{00030         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_anchoredItemStart = -\/1;}
\DoxyCodeLine{00031         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_anchoredItemEnd = -\/1;}
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033 \textcolor{preprocessor}{        \#endregion Field Region}}
\DoxyCodeLine{00034 }
\DoxyCodeLine{00035 \textcolor{preprocessor}{        \#region Property Region}}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00038         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00039         \textcolor{keyword}{public} ObservableCollection<VitNX\_ListItem> Items}
\DoxyCodeLine{00040         \{}
\DoxyCodeLine{00041             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_items; \}}
\DoxyCodeLine{00042             \textcolor{keyword}{set}}
\DoxyCodeLine{00043             \{}
\DoxyCodeLine{00044                 \textcolor{keywordflow}{if} (\_items != \textcolor{keyword}{null})}
\DoxyCodeLine{00045                     \_items.CollectionChanged -\/= Items\_CollectionChanged;}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047                 \_items = value;}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049                 \_items.CollectionChanged += Items\_CollectionChanged;}
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051                 UpdateListBox();}
\DoxyCodeLine{00052             \}}
\DoxyCodeLine{00053         \}}
\DoxyCodeLine{00054 }
\DoxyCodeLine{00055         [Browsable(\textcolor{keyword}{false})]}
\DoxyCodeLine{00056         [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]}
\DoxyCodeLine{00057         \textcolor{keyword}{public} List<int> SelectedIndices}
\DoxyCodeLine{00058         \{}
\DoxyCodeLine{00059             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_selectedIndices; \}}
\DoxyCodeLine{00060         \}}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062         [Category(\textcolor{stringliteral}{"{}Appearance"{}})]}
\DoxyCodeLine{00063         [Description(\textcolor{stringliteral}{"{}Determines the height of the individual list view items."{}})]}
\DoxyCodeLine{00064         [DefaultValue(20)]}
\DoxyCodeLine{00065         \textcolor{keyword}{public} \textcolor{keywordtype}{int} ItemHeight}
\DoxyCodeLine{00066         \{}
\DoxyCodeLine{00067             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_itemHeight; \}}
\DoxyCodeLine{00068             \textcolor{keyword}{set}}
\DoxyCodeLine{00069             \{}
\DoxyCodeLine{00070                 \_itemHeight = value;}
\DoxyCodeLine{00071                 UpdateListBox();}
\DoxyCodeLine{00072             \}}
\DoxyCodeLine{00073         \}}
\DoxyCodeLine{00074 }
\DoxyCodeLine{00075         [Category(\textcolor{stringliteral}{"{}Behaviour"{}})]}
\DoxyCodeLine{00076         [Description(\textcolor{stringliteral}{"{}Determines whether multiple list view items can be selected at once."{}})]}
\DoxyCodeLine{00077         [DefaultValue(\textcolor{keyword}{false})]}
\DoxyCodeLine{00078         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} MultiSelect}
\DoxyCodeLine{00079         \{}
\DoxyCodeLine{00080             \textcolor{keyword}{get} \{ \textcolor{keywordflow}{return} \_multiSelect; \}}
\DoxyCodeLine{00081             \textcolor{keyword}{set} \{ \_multiSelect = value; \}}
\DoxyCodeLine{00082         \}}
\DoxyCodeLine{00083 }
\DoxyCodeLine{00084         [Category(\textcolor{stringliteral}{"{}Appearance"{}})]}
\DoxyCodeLine{00085         [Description(\textcolor{stringliteral}{"{}Determines whether icons are rendered with the list items."{}})]}
\DoxyCodeLine{00086         [DefaultValue(\textcolor{keyword}{false})]}
\DoxyCodeLine{00087         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} ShowIcons \{ \textcolor{keyword}{get}; \textcolor{keyword}{set}; \}}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089 \textcolor{preprocessor}{        \#endregion Property Region}}
\DoxyCodeLine{00090 }
\DoxyCodeLine{00091 \textcolor{preprocessor}{        \#region Constructor Region}}
\DoxyCodeLine{00092 }
\DoxyCodeLine{00093         \textcolor{keyword}{public} VitNX\_ListView()}
\DoxyCodeLine{00094         \{}
\DoxyCodeLine{00095             Items = \textcolor{keyword}{new} ObservableCollection<VitNX\_ListItem>();}
\DoxyCodeLine{00096             \_selectedIndices = \textcolor{keyword}{new} List<int>();}
\DoxyCodeLine{00097         \}}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099 \textcolor{preprocessor}{        \#endregion Constructor Region}}
\DoxyCodeLine{00100 }
\DoxyCodeLine{00101 \textcolor{preprocessor}{        \#region Event Handler Region}}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Items\_CollectionChanged(\textcolor{keywordtype}{object} sender, NotifyCollectionChangedEventArgs e)}
\DoxyCodeLine{00104         \{}
\DoxyCodeLine{00105             \textcolor{keywordflow}{if} (e.NewItems != \textcolor{keyword}{null})}
\DoxyCodeLine{00106             \{}
\DoxyCodeLine{00107                 \textcolor{keyword}{using} (var g = CreateGraphics())}
\DoxyCodeLine{00108                 \{}
\DoxyCodeLine{00109                     \textcolor{comment}{// Set the area size of all new items}}
\DoxyCodeLine{00110                     \textcolor{keywordflow}{foreach} (VitNX\_ListItem item \textcolor{keywordflow}{in} e.NewItems)}
\DoxyCodeLine{00111                     \{}
\DoxyCodeLine{00112                         item.TextChanged += Item\_TextChanged;}
\DoxyCodeLine{00113                         UpdateItemSize(item, g);}
\DoxyCodeLine{00114                     \}}
\DoxyCodeLine{00115                 \}}
\DoxyCodeLine{00116 }
\DoxyCodeLine{00117                 \textcolor{comment}{// Find the starting index of the new item list and update anything past that}}
\DoxyCodeLine{00118                 \textcolor{keywordflow}{if} (e.NewStartingIndex < (Items.Count -\/ 1))}
\DoxyCodeLine{00119                 \{}
\DoxyCodeLine{00120                     \textcolor{keywordflow}{for} (var i = e.NewStartingIndex; i <= Items.Count -\/ 1; i++)}
\DoxyCodeLine{00121                     \{}
\DoxyCodeLine{00122                         UpdateItemPosition(Items[i], i);}
\DoxyCodeLine{00123                     \}}
\DoxyCodeLine{00124                 \}}
\DoxyCodeLine{00125             \}}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127             \textcolor{keywordflow}{if} (e.OldItems != \textcolor{keyword}{null})}
\DoxyCodeLine{00128             \{}
\DoxyCodeLine{00129                 \textcolor{keywordflow}{foreach} (VitNX\_ListItem item \textcolor{keywordflow}{in} e.OldItems)}
\DoxyCodeLine{00130                     item.TextChanged -\/= Item\_TextChanged;}
\DoxyCodeLine{00131 }
\DoxyCodeLine{00132                 \textcolor{comment}{// Find the starting index of the old item list and update anything past that}}
\DoxyCodeLine{00133                 \textcolor{keywordflow}{if} (e.OldStartingIndex < (Items.Count -\/ 1))}
\DoxyCodeLine{00134                 \{}
\DoxyCodeLine{00135                     \textcolor{keywordflow}{for} (var i = e.OldStartingIndex; i <= Items.Count -\/ 1; i++)}
\DoxyCodeLine{00136                     \{}
\DoxyCodeLine{00137                         UpdateItemPosition(Items[i], i);}
\DoxyCodeLine{00138                     \}}
\DoxyCodeLine{00139                 \}}
\DoxyCodeLine{00140             \}}
\DoxyCodeLine{00141 }
\DoxyCodeLine{00142             \textcolor{keywordflow}{if} (Items.Count == 0)}
\DoxyCodeLine{00143             \{}
\DoxyCodeLine{00144                 \textcolor{keywordflow}{if} (\_selectedIndices.Count > 0)}
\DoxyCodeLine{00145                 \{}
\DoxyCodeLine{00146                     \_selectedIndices.Clear();}
\DoxyCodeLine{00147 }
\DoxyCodeLine{00148                     \textcolor{keywordflow}{if} (SelectedIndicesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00149                         SelectedIndicesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00150                 \}}
\DoxyCodeLine{00151             \}}
\DoxyCodeLine{00152 }
\DoxyCodeLine{00153             UpdateContentSize();}
\DoxyCodeLine{00154         \}}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156         \textcolor{keyword}{private} \textcolor{keywordtype}{void} Item\_TextChanged(\textcolor{keywordtype}{object} sender, EventArgs e)}
\DoxyCodeLine{00157         \{}
\DoxyCodeLine{00158             var item = (VitNX\_ListItem)sender;}
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160             UpdateItemSize(item);}
\DoxyCodeLine{00161             UpdateContentSize(item);}
\DoxyCodeLine{00162             Invalidate();}
\DoxyCodeLine{00163         \}}
\DoxyCodeLine{00164 }
\DoxyCodeLine{00165         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnMouseDown(MouseEventArgs e)}
\DoxyCodeLine{00166         \{}
\DoxyCodeLine{00167             base.OnMouseDown(e);}
\DoxyCodeLine{00168 }
\DoxyCodeLine{00169             \textcolor{keywordflow}{if} (Items.Count == 0)}
\DoxyCodeLine{00170                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00171 }
\DoxyCodeLine{00172             \textcolor{keywordflow}{if} (e.Button != MouseButtons.Left \&\& e.Button != MouseButtons.Right)}
\DoxyCodeLine{00173                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00174 }
\DoxyCodeLine{00175             var pos = OffsetMousePosition;}
\DoxyCodeLine{00176 }
\DoxyCodeLine{00177             var range = ItemIndexesInView().ToList();}
\DoxyCodeLine{00178 }
\DoxyCodeLine{00179             var top = range.Min();}
\DoxyCodeLine{00180             var bottom = range.Max();}
\DoxyCodeLine{00181             var width = Math.Max(ContentSize.Width, Viewport.Width);}
\DoxyCodeLine{00182 }
\DoxyCodeLine{00183             \textcolor{keywordflow}{for} (var i = top; i <= bottom; i++)}
\DoxyCodeLine{00184             \{}
\DoxyCodeLine{00185                 var rect = \textcolor{keyword}{new} Rectangle(0, i * ItemHeight, width, ItemHeight);}
\DoxyCodeLine{00186 }
\DoxyCodeLine{00187                 \textcolor{keywordflow}{if} (rect.Contains(pos))}
\DoxyCodeLine{00188                 \{}
\DoxyCodeLine{00189                     \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Shift)}
\DoxyCodeLine{00190                         SelectAnchoredRange(i);}
\DoxyCodeLine{00191                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Control)}
\DoxyCodeLine{00192                         ToggleItem(i);}
\DoxyCodeLine{00193                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00194                         SelectItem(i);}
\DoxyCodeLine{00195                 \}}
\DoxyCodeLine{00196             \}}
\DoxyCodeLine{00197         \}}
\DoxyCodeLine{00198 }
\DoxyCodeLine{00199         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} OnKeyDown(KeyEventArgs e)}
\DoxyCodeLine{00200         \{}
\DoxyCodeLine{00201             base.OnKeyDown(e);}
\DoxyCodeLine{00202 }
\DoxyCodeLine{00203             \textcolor{keywordflow}{if} (Items.Count == 0)}
\DoxyCodeLine{00204                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00205 }
\DoxyCodeLine{00206             \textcolor{keywordflow}{if} (e.KeyCode != Keys.Down \&\& e.KeyCode != Keys.Up)}
\DoxyCodeLine{00207                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00208 }
\DoxyCodeLine{00209             \textcolor{keywordflow}{if} (MultiSelect \&\& ModifierKeys == Keys.Shift)}
\DoxyCodeLine{00210             \{}
\DoxyCodeLine{00211                 \textcolor{keywordflow}{if} (e.KeyCode == Keys.Up)}
\DoxyCodeLine{00212                 \{}
\DoxyCodeLine{00213                     \textcolor{keywordflow}{if} (\_anchoredItemEnd -\/ 1 >= 0)}
\DoxyCodeLine{00214                     \{}
\DoxyCodeLine{00215                         SelectAnchoredRange(\_anchoredItemEnd -\/ 1);}
\DoxyCodeLine{00216                         EnsureVisible();}
\DoxyCodeLine{00217                     \}}
\DoxyCodeLine{00218                 \}}
\DoxyCodeLine{00219                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.KeyCode == Keys.Down)}
\DoxyCodeLine{00220                 \{}
\DoxyCodeLine{00221                     \textcolor{keywordflow}{if} (\_anchoredItemEnd + 1 <= Items.Count -\/ 1)}
\DoxyCodeLine{00222                     \{}
\DoxyCodeLine{00223                         SelectAnchoredRange(\_anchoredItemEnd + 1);}
\DoxyCodeLine{00224                     \}}
\DoxyCodeLine{00225                 \}}
\DoxyCodeLine{00226             \}}
\DoxyCodeLine{00227             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00228             \{}
\DoxyCodeLine{00229                 \textcolor{keywordflow}{if} (e.KeyCode == Keys.Up)}
\DoxyCodeLine{00230                 \{}
\DoxyCodeLine{00231                     \textcolor{keywordflow}{if} (\_anchoredItemEnd -\/ 1 >= 0)}
\DoxyCodeLine{00232                         SelectItem(\_anchoredItemEnd -\/ 1);}
\DoxyCodeLine{00233                 \}}
\DoxyCodeLine{00234                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (e.KeyCode == Keys.Down)}
\DoxyCodeLine{00235                 \{}
\DoxyCodeLine{00236                     \textcolor{keywordflow}{if} (\_anchoredItemEnd + 1 <= Items.Count -\/ 1)}
\DoxyCodeLine{00237                         SelectItem(\_anchoredItemEnd + 1);}
\DoxyCodeLine{00238                 \}}
\DoxyCodeLine{00239             \}}
\DoxyCodeLine{00240 }
\DoxyCodeLine{00241             EnsureVisible();}
\DoxyCodeLine{00242         \}}
\DoxyCodeLine{00243 }
\DoxyCodeLine{00244 \textcolor{preprocessor}{        \#endregion Event Handler Region}}
\DoxyCodeLine{00245 }
\DoxyCodeLine{00246 \textcolor{preprocessor}{        \#region Method Region}}
\DoxyCodeLine{00247 }
\DoxyCodeLine{00248         \textcolor{keyword}{public} \textcolor{keywordtype}{int} GetItemIndex(VitNX\_ListItem item)}
\DoxyCodeLine{00249         \{}
\DoxyCodeLine{00250             \textcolor{keywordflow}{return} Items.IndexOf(item);}
\DoxyCodeLine{00251         \}}
\DoxyCodeLine{00252 }
\DoxyCodeLine{00253         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectItem(\textcolor{keywordtype}{int} index)}
\DoxyCodeLine{00254         \{}
\DoxyCodeLine{00255             \textcolor{keywordflow}{if} (index < 0 || index > Items.Count -\/ 1)}
\DoxyCodeLine{00256                 \textcolor{keywordflow}{throw} \textcolor{keyword}{new} IndexOutOfRangeException(\$\textcolor{stringliteral}{"{}Value '\{index\}' is outside of valid range."{}});}
\DoxyCodeLine{00257 }
\DoxyCodeLine{00258             \_selectedIndices.Clear();}
\DoxyCodeLine{00259             \_selectedIndices.Add(index);}
\DoxyCodeLine{00260 }
\DoxyCodeLine{00261             \textcolor{keywordflow}{if} (SelectedIndicesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00262                 SelectedIndicesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00263 }
\DoxyCodeLine{00264             \_anchoredItemStart = index;}
\DoxyCodeLine{00265             \_anchoredItemEnd = index;}
\DoxyCodeLine{00266 }
\DoxyCodeLine{00267             Invalidate();}
\DoxyCodeLine{00268         \}}
\DoxyCodeLine{00269 }
\DoxyCodeLine{00270         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectItems(IEnumerable<int> indexes)}
\DoxyCodeLine{00271         \{}
\DoxyCodeLine{00272             \_selectedIndices.Clear();}
\DoxyCodeLine{00273 }
\DoxyCodeLine{00274             var list = indexes.ToList();}
\DoxyCodeLine{00275 }
\DoxyCodeLine{00276             \textcolor{keywordflow}{foreach} (var index \textcolor{keywordflow}{in} list)}
\DoxyCodeLine{00277             \{}
\DoxyCodeLine{00278                 \textcolor{keywordflow}{if} (index < 0 || index > Items.Count -\/ 1)}
\DoxyCodeLine{00279                     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} IndexOutOfRangeException(\$\textcolor{stringliteral}{"{}Value '\{index\}' is outside of valid range."{}});}
\DoxyCodeLine{00280 }
\DoxyCodeLine{00281                 \_selectedIndices.Add(index);}
\DoxyCodeLine{00282             \}}
\DoxyCodeLine{00283 }
\DoxyCodeLine{00284             \textcolor{keywordflow}{if} (SelectedIndicesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00285                 SelectedIndicesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00286 }
\DoxyCodeLine{00287             \_anchoredItemStart = list[list.Count -\/ 1];}
\DoxyCodeLine{00288             \_anchoredItemEnd = list[list.Count -\/ 1];}
\DoxyCodeLine{00289 }
\DoxyCodeLine{00290             Invalidate();}
\DoxyCodeLine{00291         \}}
\DoxyCodeLine{00292 }
\DoxyCodeLine{00293         \textcolor{keyword}{public} \textcolor{keywordtype}{void} ToggleItem(\textcolor{keywordtype}{int} index)}
\DoxyCodeLine{00294         \{}
\DoxyCodeLine{00295             \textcolor{keywordflow}{if} (\_selectedIndices.Contains(index))}
\DoxyCodeLine{00296             \{}
\DoxyCodeLine{00297                 \_selectedIndices.Remove(index);}
\DoxyCodeLine{00298 }
\DoxyCodeLine{00299                 \textcolor{comment}{// If we just removed both the anchor start AND end then reset them}}
\DoxyCodeLine{00300                 \textcolor{keywordflow}{if} (\_anchoredItemStart == index \&\& \_anchoredItemEnd == index)}
\DoxyCodeLine{00301                 \{}
\DoxyCodeLine{00302                     \textcolor{keywordflow}{if} (\_selectedIndices.Count > 0)}
\DoxyCodeLine{00303                     \{}
\DoxyCodeLine{00304                         \_anchoredItemStart = \_selectedIndices[0];}
\DoxyCodeLine{00305                         \_anchoredItemEnd = \_selectedIndices[0];}
\DoxyCodeLine{00306                     \}}
\DoxyCodeLine{00307                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00308                     \{}
\DoxyCodeLine{00309                         \_anchoredItemStart = -\/1;}
\DoxyCodeLine{00310                         \_anchoredItemEnd = -\/1;}
\DoxyCodeLine{00311                     \}}
\DoxyCodeLine{00312                 \}}
\DoxyCodeLine{00313 }
\DoxyCodeLine{00314                 \textcolor{comment}{// If we just removed the anchor start then update it accordingly}}
\DoxyCodeLine{00315                 \textcolor{keywordflow}{if} (\_anchoredItemStart == index)}
\DoxyCodeLine{00316                 \{}
\DoxyCodeLine{00317                     \textcolor{keywordflow}{if} (\_anchoredItemEnd < index)}
\DoxyCodeLine{00318                         \_anchoredItemStart = index -\/ 1;}
\DoxyCodeLine{00319                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\_anchoredItemEnd > index)}
\DoxyCodeLine{00320                         \_anchoredItemStart = index + 1;}
\DoxyCodeLine{00321                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00322                         \_anchoredItemStart = \_anchoredItemEnd;}
\DoxyCodeLine{00323                 \}}
\DoxyCodeLine{00324 }
\DoxyCodeLine{00325                 \textcolor{comment}{// If we just removed the anchor end then update it accordingly}}
\DoxyCodeLine{00326                 \textcolor{keywordflow}{if} (\_anchoredItemEnd == index)}
\DoxyCodeLine{00327                 \{}
\DoxyCodeLine{00328                     \textcolor{keywordflow}{if} (\_anchoredItemStart < index)}
\DoxyCodeLine{00329                         \_anchoredItemEnd = index -\/ 1;}
\DoxyCodeLine{00330                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\_anchoredItemStart > index)}
\DoxyCodeLine{00331                         \_anchoredItemEnd = index + 1;}
\DoxyCodeLine{00332                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{00333                         \_anchoredItemEnd = \_anchoredItemStart;}
\DoxyCodeLine{00334                 \}}
\DoxyCodeLine{00335             \}}
\DoxyCodeLine{00336             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00337             \{}
\DoxyCodeLine{00338                 \_selectedIndices.Add(index);}
\DoxyCodeLine{00339                 \_anchoredItemStart = index;}
\DoxyCodeLine{00340                 \_anchoredItemEnd = index;}
\DoxyCodeLine{00341             \}}
\DoxyCodeLine{00342 }
\DoxyCodeLine{00343             \textcolor{keywordflow}{if} (SelectedIndicesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00344                 SelectedIndicesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00345 }
\DoxyCodeLine{00346             Invalidate();}
\DoxyCodeLine{00347         \}}
\DoxyCodeLine{00348 }
\DoxyCodeLine{00349         \textcolor{keyword}{public} \textcolor{keywordtype}{void} SelectItems(\textcolor{keywordtype}{int} startRange, \textcolor{keywordtype}{int} endRange)}
\DoxyCodeLine{00350         \{}
\DoxyCodeLine{00351             \_selectedIndices.Clear();}
\DoxyCodeLine{00352 }
\DoxyCodeLine{00353             \textcolor{keywordflow}{if} (startRange == endRange)}
\DoxyCodeLine{00354                 \_selectedIndices.Add(startRange);}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356             \textcolor{keywordflow}{if} (startRange < endRange)}
\DoxyCodeLine{00357             \{}
\DoxyCodeLine{00358                 \textcolor{keywordflow}{for} (var i = startRange; i <= endRange; i++)}
\DoxyCodeLine{00359                     \_selectedIndices.Add(i);}
\DoxyCodeLine{00360             \}}
\DoxyCodeLine{00361             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (startRange > endRange)}
\DoxyCodeLine{00362             \{}
\DoxyCodeLine{00363                 \textcolor{keywordflow}{for} (var i = startRange; i >= endRange; i-\/-\/)}
\DoxyCodeLine{00364                     \_selectedIndices.Add(i);}
\DoxyCodeLine{00365             \}}
\DoxyCodeLine{00366 }
\DoxyCodeLine{00367             \textcolor{keywordflow}{if} (SelectedIndicesChanged != \textcolor{keyword}{null})}
\DoxyCodeLine{00368                 SelectedIndicesChanged(\textcolor{keyword}{this}, \textcolor{keyword}{null});}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370             Invalidate();}
\DoxyCodeLine{00371         \}}
\DoxyCodeLine{00372 }
\DoxyCodeLine{00373         \textcolor{keyword}{private} \textcolor{keywordtype}{void} SelectAnchoredRange(\textcolor{keywordtype}{int} index)}
\DoxyCodeLine{00374         \{}
\DoxyCodeLine{00375             \_anchoredItemEnd = index;}
\DoxyCodeLine{00376             SelectItems(\_anchoredItemStart, index);}
\DoxyCodeLine{00377         \}}
\DoxyCodeLine{00378 }
\DoxyCodeLine{00379         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateListBox()}
\DoxyCodeLine{00380         \{}
\DoxyCodeLine{00381             \textcolor{keyword}{using} (var g = CreateGraphics())}
\DoxyCodeLine{00382             \{}
\DoxyCodeLine{00383                 \textcolor{keywordflow}{for} (var i = 0; i <= Items.Count -\/ 1; i++)}
\DoxyCodeLine{00384                 \{}
\DoxyCodeLine{00385                     var item = Items[i];}
\DoxyCodeLine{00386                     UpdateItemSize(item, g);}
\DoxyCodeLine{00387                     UpdateItemPosition(item, i);}
\DoxyCodeLine{00388                 \}}
\DoxyCodeLine{00389             \}}
\DoxyCodeLine{00390 }
\DoxyCodeLine{00391             UpdateContentSize();}
\DoxyCodeLine{00392         \}}
\DoxyCodeLine{00393 }
\DoxyCodeLine{00394         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateItemSize(VitNX\_ListItem item)}
\DoxyCodeLine{00395         \{}
\DoxyCodeLine{00396             \textcolor{keyword}{using} (var g = CreateGraphics())}
\DoxyCodeLine{00397             \{}
\DoxyCodeLine{00398                 UpdateItemSize(item, g);}
\DoxyCodeLine{00399             \}}
\DoxyCodeLine{00400         \}}
\DoxyCodeLine{00401 }
\DoxyCodeLine{00402         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateItemSize(VitNX\_ListItem item, Graphics g)}
\DoxyCodeLine{00403         \{}
\DoxyCodeLine{00404             var size = g.MeasureString(item.Text, Font);}
\DoxyCodeLine{00405             size.Width++;}
\DoxyCodeLine{00406 }
\DoxyCodeLine{00407             \textcolor{keywordflow}{if} (ShowIcons)}
\DoxyCodeLine{00408                 size.Width += \_iconSize + 8;}
\DoxyCodeLine{00409 }
\DoxyCodeLine{00410             item.Area = \textcolor{keyword}{new} Rectangle(item.Area.Left, item.Area.Top, (\textcolor{keywordtype}{int})size.Width, item.Area.Height);}
\DoxyCodeLine{00411         \}}
\DoxyCodeLine{00412 }
\DoxyCodeLine{00413         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateItemPosition(VitNX\_ListItem item, \textcolor{keywordtype}{int} index)}
\DoxyCodeLine{00414         \{}
\DoxyCodeLine{00415             item.Area = \textcolor{keyword}{new} Rectangle(2, (index * ItemHeight), item.Area.Width, ItemHeight);}
\DoxyCodeLine{00416         \}}
\DoxyCodeLine{00417 }
\DoxyCodeLine{00418         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateContentSize()}
\DoxyCodeLine{00419         \{}
\DoxyCodeLine{00420             var highestWidth = 0;}
\DoxyCodeLine{00421 }
\DoxyCodeLine{00422             \textcolor{keywordflow}{foreach} (var item \textcolor{keywordflow}{in} Items)}
\DoxyCodeLine{00423             \{}
\DoxyCodeLine{00424                 \textcolor{keywordflow}{if} (item.Area.Right + 1 > highestWidth)}
\DoxyCodeLine{00425                     highestWidth = item.Area.Right + 1;}
\DoxyCodeLine{00426             \}}
\DoxyCodeLine{00427 }
\DoxyCodeLine{00428             var width = highestWidth;}
\DoxyCodeLine{00429             var height = Items.Count * ItemHeight;}
\DoxyCodeLine{00430 }
\DoxyCodeLine{00431             \textcolor{keywordflow}{if} (ContentSize.Width != width || ContentSize.Height != height)}
\DoxyCodeLine{00432             \{}
\DoxyCodeLine{00433                 ContentSize = \textcolor{keyword}{new} Size(width, height);}
\DoxyCodeLine{00434                 Invalidate();}
\DoxyCodeLine{00435             \}}
\DoxyCodeLine{00436         \}}
\DoxyCodeLine{00437 }
\DoxyCodeLine{00438         \textcolor{keyword}{private} \textcolor{keywordtype}{void} UpdateContentSize(VitNX\_ListItem item)}
\DoxyCodeLine{00439         \{}
\DoxyCodeLine{00440             var itemWidth = item.Area.Right + 1;}
\DoxyCodeLine{00441 }
\DoxyCodeLine{00442             \textcolor{keywordflow}{if} (itemWidth == ContentSize.Width)}
\DoxyCodeLine{00443             \{}
\DoxyCodeLine{00444                 UpdateContentSize();}
\DoxyCodeLine{00445                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00446             \}}
\DoxyCodeLine{00447 }
\DoxyCodeLine{00448             \textcolor{keywordflow}{if} (itemWidth > ContentSize.Width)}
\DoxyCodeLine{00449             \{}
\DoxyCodeLine{00450                 ContentSize = \textcolor{keyword}{new} Size(itemWidth, ContentSize.Height);}
\DoxyCodeLine{00451                 Invalidate();}
\DoxyCodeLine{00452             \}}
\DoxyCodeLine{00453         \}}
\DoxyCodeLine{00454 }
\DoxyCodeLine{00455         \textcolor{keyword}{public} \textcolor{keywordtype}{void} EnsureVisible()}
\DoxyCodeLine{00456         \{}
\DoxyCodeLine{00457             \textcolor{keywordflow}{if} (SelectedIndices.Count == 0)}
\DoxyCodeLine{00458                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00459 }
\DoxyCodeLine{00460             var itemTop = -\/1;}
\DoxyCodeLine{00461 }
\DoxyCodeLine{00462             \textcolor{keywordflow}{if} (!MultiSelect)}
\DoxyCodeLine{00463                 itemTop = SelectedIndices[0] * ItemHeight;}
\DoxyCodeLine{00464             \textcolor{keywordflow}{else}}
\DoxyCodeLine{00465                 itemTop = \_anchoredItemEnd * ItemHeight;}
\DoxyCodeLine{00466 }
\DoxyCodeLine{00467             var itemBottom = itemTop + ItemHeight;}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00469             \textcolor{keywordflow}{if} (itemTop < Viewport.Top)}
\DoxyCodeLine{00470                 VScrollTo(itemTop);}
\DoxyCodeLine{00471 }
\DoxyCodeLine{00472             \textcolor{keywordflow}{if} (itemBottom > Viewport.Bottom)}
\DoxyCodeLine{00473                 VScrollTo((itemBottom -\/ Viewport.Height));}
\DoxyCodeLine{00474         \}}
\DoxyCodeLine{00475 }
\DoxyCodeLine{00476         \textcolor{keyword}{private} IEnumerable<int> ItemIndexesInView()}
\DoxyCodeLine{00477         \{}
\DoxyCodeLine{00478             var top = (Viewport.Top / ItemHeight) -\/ 1;}
\DoxyCodeLine{00479 }
\DoxyCodeLine{00480             \textcolor{keywordflow}{if} (top < 0)}
\DoxyCodeLine{00481                 top = 0;}
\DoxyCodeLine{00482 }
\DoxyCodeLine{00483             var bottom = ((Viewport.Top + Viewport.Height) / ItemHeight) + 1;}
\DoxyCodeLine{00484 }
\DoxyCodeLine{00485             \textcolor{keywordflow}{if} (bottom > Items.Count)}
\DoxyCodeLine{00486                 bottom = Items.Count;}
\DoxyCodeLine{00487 }
\DoxyCodeLine{00488             var result = Enumerable.Range(top, bottom -\/ top);}
\DoxyCodeLine{00489             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00490         \}}
\DoxyCodeLine{00491 }
\DoxyCodeLine{00492         \textcolor{keyword}{private} IEnumerable<VitNX\_ListItem> ItemsInView()}
\DoxyCodeLine{00493         \{}
\DoxyCodeLine{00494             var indexes = ItemIndexesInView();}
\DoxyCodeLine{00495             var result = indexes.Select(index => Items[index]).ToList();}
\DoxyCodeLine{00496             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00497         \}}
\DoxyCodeLine{00498 }
\DoxyCodeLine{00499 \textcolor{preprocessor}{        \#endregion Method Region}}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501 \textcolor{preprocessor}{        \#region Paint Region}}
\DoxyCodeLine{00502 }
\DoxyCodeLine{00503         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{void} PaintContent(Graphics g)}
\DoxyCodeLine{00504         \{}
\DoxyCodeLine{00505             var range = ItemIndexesInView().ToList();}
\DoxyCodeLine{00506 }
\DoxyCodeLine{00507             \textcolor{keywordflow}{if} (range.Count == 0)}
\DoxyCodeLine{00508                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{00509 }
\DoxyCodeLine{00510             var top = range.Min();}
\DoxyCodeLine{00511             var bottom = range.Max();}
\DoxyCodeLine{00512 }
\DoxyCodeLine{00513             \textcolor{keywordflow}{for} (var i = top; i <= bottom; i++)}
\DoxyCodeLine{00514             \{}
\DoxyCodeLine{00515                 var width = Math.Max(ContentSize.Width, Viewport.Width);}
\DoxyCodeLine{00516                 var rect = \textcolor{keyword}{new} Rectangle(0, i * ItemHeight, width, ItemHeight);}
\DoxyCodeLine{00517 }
\DoxyCodeLine{00518                 \textcolor{comment}{// Background}}
\DoxyCodeLine{00519                 var odd = i \% 2 != 0;}
\DoxyCodeLine{00520                 var bgColor = !odd ? Colors.HeaderBackground : Colors.GreyBackground;}
\DoxyCodeLine{00521 }
\DoxyCodeLine{00522                 \textcolor{keywordflow}{if} (SelectedIndices.Count > 0 \&\& SelectedIndices.Contains(i))}
\DoxyCodeLine{00523                     bgColor = Focused ? Colors.BlueSelection : Colors.GreySelection;}
\DoxyCodeLine{00524 }
\DoxyCodeLine{00525                 \textcolor{keyword}{using} (var b = \textcolor{keyword}{new} SolidBrush(bgColor))}
\DoxyCodeLine{00526                 \{}
\DoxyCodeLine{00527                     g.FillRectangle(b, rect);}
\DoxyCodeLine{00528                 \}}
\DoxyCodeLine{00529 }
\DoxyCodeLine{00530                 \textcolor{comment}{// DEBUG: Border}}
\DoxyCodeLine{00531                 \textcolor{comment}{/*using (var p = new Pen(Colors.VitNXBorder))}}
\DoxyCodeLine{00532 \textcolor{comment}{                \{}}
\DoxyCodeLine{00533 \textcolor{comment}{                    g.DrawLine(p, new Point(rect.Left, rect.Bottom -\/ 1), new Point(rect.Right, rect.Bottom -\/ 1));}}
\DoxyCodeLine{00534 \textcolor{comment}{                \}*/}}
\DoxyCodeLine{00535 }
\DoxyCodeLine{00536                 \textcolor{comment}{// Icon}}
\DoxyCodeLine{00537                 \textcolor{keywordflow}{if} (ShowIcons \&\& Items[i].Icon != \textcolor{keyword}{null})}
\DoxyCodeLine{00538                 \{}
\DoxyCodeLine{00539                     g.DrawImageUnscaled(Items[i].Icon, \textcolor{keyword}{new} Point(rect.Left + 5, rect.Top + (rect.Height / 2) -\/ (\_iconSize / 2)));}
\DoxyCodeLine{00540                 \}}
\DoxyCodeLine{00541 }
\DoxyCodeLine{00542                 \textcolor{comment}{// Text}}
\DoxyCodeLine{00543                 \textcolor{keyword}{using} (var b = \textcolor{keyword}{new} SolidBrush(Items[i].TextColor))}
\DoxyCodeLine{00544                 \{}
\DoxyCodeLine{00545                     var stringFormat = \textcolor{keyword}{new} StringFormat}
\DoxyCodeLine{00546                     \{}
\DoxyCodeLine{00547                         Alignment = StringAlignment.Near,}
\DoxyCodeLine{00548                         LineAlignment = StringAlignment.Center}
\DoxyCodeLine{00549                     \};}
\DoxyCodeLine{00550 }
\DoxyCodeLine{00551                     var modFont = \textcolor{keyword}{new} Font(Font, Items[i].FontStyle);}
\DoxyCodeLine{00552 }
\DoxyCodeLine{00553                     var modRect = \textcolor{keyword}{new} Rectangle(rect.Left + 2, rect.Top, rect.Width, rect.Height);}
\DoxyCodeLine{00554 }
\DoxyCodeLine{00555                     \textcolor{keywordflow}{if} (ShowIcons)}
\DoxyCodeLine{00556                         modRect.X += \_iconSize + 8;}
\DoxyCodeLine{00557 }
\DoxyCodeLine{00558                     g.DrawString(Items[i].Text, modFont, b, modRect, stringFormat);}
\DoxyCodeLine{00559                 \}}
\DoxyCodeLine{00560             \}}
\DoxyCodeLine{00561         \}}
\DoxyCodeLine{00562 }
\DoxyCodeLine{00563 \textcolor{preprocessor}{        \#endregion Paint Region}}
\DoxyCodeLine{00564     \}}
\DoxyCodeLine{00565 \}}

\end{DoxyCode}
